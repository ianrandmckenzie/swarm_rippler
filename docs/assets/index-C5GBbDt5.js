(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();const Fe="modulepreload",$e=function(n){return"/"+n},ye={},Ne=function(e,t,i){let o=Promise.resolve();if(t&&t.length>0){let a=function(l){return Promise.all(l.map(d=>Promise.resolve(d).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),c=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));o=a(t.map(l=>{if(l=$e(l),l in ye)return;ye[l]=!0;const d=l.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":Fe,d||(h.as="script"),h.crossOrigin="",h.href=l,c&&h.setAttribute("nonce",c),document.head.appendChild(h),d)return new Promise((m,w)=>{h.addEventListener("load",m),h.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return o.then(a=>{for(const r of a||[])r.status==="rejected"&&s(r.reason);return e().catch(s)})},ze="clickRippleDB",Xe=1;function $(){return new Promise((n,e)=>{const t=indexedDB.open(ze,Xe);t.onupgradeneeded=i=>{const o=i.target.result;o.objectStoreNames.contains("settings")||o.createObjectStore("settings"),o.objectStoreNames.contains("sequences")||o.createObjectStore("sequences",{autoIncrement:!0})},t.onsuccess=i=>n(i.target.result),t.onerror=i=>e(i.target.error)})}async function me(n){const e=await $();return new Promise(t=>{const o=e.transaction("settings","readonly").objectStore("settings").get(n);o.onsuccess=()=>t(o.result),o.onerror=()=>t(null)})}async function ie(n,e){(await $()).transaction("settings","readwrite").objectStore("settings").put(e,n)}async function Ye(n){const t=(await $()).transaction("sequences","readwrite");let i;Array.isArray(n)?i={sequence:n,isLoop:!1,loopInterval:3}:i=n,t.objectStore("sequences").add(i)}async function N(){const n=await $();return new Promise(e=>{const i=n.transaction("sequences","readonly").objectStore("sequences").getAll();i.onsuccess=()=>e(i.result||[]),i.onerror=()=>e([])})}async function Te(){return await me("preferences")||{theme:"system",volume:.7,showTutorial:!0}}async function Ue(n){await ie("preferences",n)}async function je(n,e){const o=(await $()).transaction("sequences","readwrite").objectStore("sequences");return new Promise((s,a)=>{const r=o.getAll();r.onsuccess=()=>{const c=r.result||[];if(n>=0&&n<c.length){const l=o.put(e,n+1);l.onsuccess=()=>{console.log("Sequence updated successfully"),s()},l.onerror=()=>{console.error("Failed to update sequence:",l.error),a(l.error)}}else a(new Error("Invalid sequence index"))},r.onerror=()=>{console.error("Failed to get sequences for update:",r.error),a(r.error)}})}async function Je(n){const i=(await $()).transaction("sequences","readwrite").objectStore("sequences");return new Promise((o,s)=>{const a=i.getAll();a.onsuccess=()=>{const r=a.result||[];if(n>=0&&n<r.length){const c=i.clear();c.onsuccess=()=>{const l=r.filter((u,h)=>h!==n);let d=0;if(l.length===0){console.log("Sequence deleted successfully (store now empty)"),o();return}l.forEach((u,h)=>{const m=i.add(u,h+1);m.onsuccess=()=>{d++,d===l.length&&(console.log("Sequence deleted successfully"),o())},m.onerror=()=>{console.error("Failed to re-add sequence:",m.error),s(m.error)}})},c.onerror=()=>{console.error("Failed to clear store for deletion:",c.error),s(c.error)}}else s(new Error("Invalid sequence index"))},a.onerror=()=>{console.error("Failed to get sequences for deletion:",a.error),s(a.error)}})}class Ve{constructor(){this.isSupported=this.checkSupport()}checkSupport(){var e;return!!(navigator.vibrate||window.DeviceMotionEvent||window.TapticEngine||(e=window.__TAURI__)!=null&&e.invoke)}trigger(e="light",t=.5){var s;if(!this.isSupported)return;const i={light:[10],medium:[20],heavy:[40],radian:[15,10,15],select:[8],success:[25,15,25]},o=i[e]||i.light;try{navigator.vibrate?navigator.vibrate(o):window.TapticEngine?window.TapticEngine.impact({style:e}):(s=window.__TAURI__)!=null&&s.invoke&&window.__TAURI__.invoke("haptic_feedback",{type:e,intensity:t})}catch(a){console.debug("Haptic feedback not available:",a)}}radianFeedback(e){const t=[.3,.5,.7],i=e%3;this.trigger("radian",t[i])}}class v{static bounce(e,t=1.05,i=150){e&&(e.style.transition=`transform ${i}ms cubic-bezier(0.68, -0.55, 0.265, 1.55)`,e.style.transform=`scale(${t})`,setTimeout(()=>{e.style.transform="scale(1)",setTimeout(()=>{e.style.transition="",e.style.transform=""},i)},i))}static press(e,t=.95,i=100){e&&(e.style.transition=`transform ${i}ms ease-out`,e.style.transform=`scale(${t})`,setTimeout(()=>{e.style.transform="scale(1)",setTimeout(()=>{e.style.transition="",e.style.transform=""},i)},i))}static pulse(e,t=null,i=300){if(!e)return;t||(t=document.documentElement.classList.contains("dark")?"rgba(255, 241, 118, 0.6)":"rgba(255, 235, 59, 0.6)");const o=e.style.boxShadow;e.style.transition=`box-shadow ${i}ms ease-out`,e.style.boxShadow=`0 0 20px 4px ${t}`,setTimeout(()=>{e.style.boxShadow=o,setTimeout(()=>{e.style.transition=""},i)},i)}static canvasRipple(e,t,i,o=null){if(!e)return;o||(o=(window.themeManager?window.themeManager.getEffectiveTheme():"light")==="dark"?"rgba(255, 255, 255, 0.8)":"rgba(0, 0, 0, 0.8)");const s=document.createElement("div");if(s.style.position="absolute",s.style.left=`${t-10}px`,s.style.top=`${i-10}px`,s.style.width="20px",s.style.height="20px",s.style.borderRadius="50%",s.style.background=o,s.style.pointerEvents="none",s.style.animation="feedback-ripple 0.6s ease-out forwards",s.style.zIndex="1000",!document.getElementById("feedback-styles")){const r=document.createElement("style");r.id="feedback-styles",r.textContent=`
        @keyframes feedback-ripple {
          0% {
            transform: scale(0);
            opacity: 1;
          }
          100% {
            transform: scale(4);
            opacity: 0;
          }
        }
      `,document.head.appendChild(r)}const a=e.closest('[id*="container"]')||e.parentElement;a&&(a.style.position="relative",a.appendChild(s),setTimeout(()=>{s.parentElement&&s.parentElement.removeChild(s)},600))}}const M=new Ve;window.feedbackSystem={haptic:M,visual:v};class Ge{constructor(){this.themes=["light","dark","system"],this.currentTheme="system",this.init()}async init(){await this.loadThemePreference(),this.applyTheme(this.currentTheme),this.setupEventListeners(),this.setupSystemThemeListener(),this.updateThemeButtons(),await new Promise(e=>setTimeout(e,50)),this.initialized=!0,window.dispatchEvent(new CustomEvent("themeManagerReady"))}async loadThemePreference(){try{const e=await Te();this.currentTheme=e.theme||"system"}catch{console.log("No stored theme preference, using system default"),this.currentTheme="system"}}async saveThemePreference(e){try{const t=await Te();t.theme=e,await Ue(t)}catch(t){console.error("Failed to save theme preference:",t)}}setupEventListeners(){document.querySelectorAll("button[data-theme]").forEach(t=>{const i=t.dataset.theme;t.addEventListener("click",o=>{const s=o.currentTarget.dataset.theme;v.bounce(t,1.08,150),M.trigger("light"),this.setTheme(s),window.innerWidth<640&&this.showMobileTooltip(t,s)}),t.addEventListener("mouseenter",o=>{window.innerWidth>=640&&this.showThemeTooltip(o.currentTarget,i)}),t.addEventListener("mouseleave",()=>{window.innerWidth>=640&&this.hideTooltip()})})}setupSystemThemeListener(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{this.currentTheme==="system"&&this.applySystemTheme()})}async setTheme(e){this.themes.includes(e)&&(this.currentTheme=e,await this.saveThemePreference(e),this.applyTheme(e),this.updateThemeButtons())}applyTheme(e){const t=document.documentElement;t.classList.remove("dark","light"),e==="dark"?t.classList.add("dark"):e==="light"?t.classList.add("light"):e==="system"&&this.applySystemTheme(),this.updateMetaThemeColor(e),window.audioSystem&&window.audioSystem.updateThumbnailLoopStates&&window.audioSystem.updateThumbnailLoopStates()}applySystemTheme(){const e=document.documentElement,t=window.matchMedia("(prefers-color-scheme: dark)").matches;e.classList.remove("dark","light"),t?e.classList.add("dark"):e.classList.add("light"),window.audioSystem&&window.audioSystem.updateThumbnailLoopStates&&window.audioSystem.updateThumbnailLoopStates()}updateMetaThemeColor(e){const t=document.querySelector('meta[name="theme-color"]'),i=document.querySelector('meta[name="msapplication-TileColor"]');let o;e==="dark"||e==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches?o="#232323":o="#1F1F1F",t&&t.setAttribute("content",o),i&&i.setAttribute("content",o)}updateThemeButtons(){document.querySelectorAll("button[data-theme]").forEach(t=>{if(t.classList.remove("bg-swarmshadow-200","text-swarmlight-100","ring-2","ring-swarmlight-300","bg-swarmlight-300","text-swarmshadow-200","ring-swarmshadow-200","bg-swarmlight-200","text-black","text-white","font-semibold"),t.classList.remove("active"),t.dataset.theme===this.currentTheme){const i=t.dataset.theme,o=document.documentElement.classList.contains("dark");i==="dark"?t.classList.add("bg-swarmshadow-200","text-swarmlight-100"):i==="light"?t.classList.add("bg-swarmlight-300","text-swarmshadow-200"):i==="system"&&(t.classList.add("ring-2","font-semibold"),o?(t.classList.add("text-white","ring-swarmlight-600","dark:hover:text-swarmlight-50"),t.classList.remove("dark:hover:text-black")):t.classList.add("text-black","ring-swarmlight-300"),o?t.style.background="linear-gradient(45deg, #706A43 50%, #232323 50%)":t.style.background="linear-gradient(45deg, #FFFDE7 50%, #FFEE58 50%)"),i!=="system"&&(t.classList.add("ring-2"),o?t.classList.add("ring-swarmlight-600"):t.classList.add("ring-swarmlight-300"))}else t.dataset.theme==="system"&&(t.classList.add("dark:hover:text-black"),t.classList.remove("dark:hover:text-swarmlight-50"),t.style.background="")})}getCurrentTheme(){return this.currentTheme}getEffectiveTheme(){return this.currentTheme==="system"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":this.currentTheme}getThemeDescription(e){switch(e){case"light":return"Light theme - bright interface";case"dark":return"Dark theme - dark interface";case"system":return"System theme - follows your device settings";default:return"Theme option"}}showThemeTooltip(e,t){const i=this.getThemeDescription(t);if(window.showTooltip){const s=e.closest(".theme-switcher")||e;window.showTooltip(i,s,0)}}showMobileTooltip(e,t){const i=this.getThemeDescription(t);if(window.showTooltip){const s=e.closest(".theme-switcher")||e;window.showTooltip(i,s,0),setTimeout(()=>{window.hideTooltip&&window.hideTooltip()},2e3)}}hideTooltip(){window.hideTooltip&&window.hideTooltip()}}document.addEventListener("DOMContentLoaded",()=>{window.themeManager=new Ge});class Me{constructor(){this.sidenav=document.getElementById("sidenav"),this.toggleBtn=document.getElementById("sidenavToggle"),this.closeBtn=document.getElementById("sidenavClose"),this.infoBtn=document.getElementById("infoBtn"),this.resetTutorialBtn=document.getElementById("resetTutorialBtn"),this.appInfoModal=document.getElementById("appInfoModal"),this.closeAppInfoBtn=document.getElementById("closeAppInfoBtn"),this.isOpen=!1,this.init()}init(){this.setupEventListeners(),this.setupTooltips()}setupEventListeners(){this.toggleBtn.addEventListener("click",()=>{v.bounce(this.toggleBtn,1.1,120),M.trigger("light"),this.toggle()}),this.closeBtn.addEventListener("click",()=>{v.press(this.closeBtn,.9,100),M.trigger("light"),this.close()}),this.infoBtn.addEventListener("click",()=>{v.bounce(this.infoBtn,1.1,120),M.trigger("light"),this.openAppInfoModal()}),this.resetTutorialBtn.addEventListener("click",()=>{v.bounce(this.resetTutorialBtn,1.1,120),M.trigger("medium"),this.resetTutorial()}),this.closeAppInfoBtn.addEventListener("click",()=>{v.press(this.closeAppInfoBtn,.95,100),M.trigger("light"),this.closeAppInfoModal()}),this.appInfoModal.addEventListener("click",e=>{e.target===this.appInfoModal&&this.closeAppInfoModal()}),document.addEventListener("click",e=>{this.isOpen&&!this.sidenav.contains(e.target)&&!this.toggleBtn.contains(e.target)&&this.close()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&(this.appInfoModal&&!this.appInfoModal.classList.contains("hidden")?this.closeAppInfoModal():this.isOpen&&this.close())})}setupTooltips(){this.infoBtn.addEventListener("mouseenter",()=>{window.showTooltip&&window.innerWidth>=640&&window.showTooltip("App information",this.infoBtn)}),this.infoBtn.addEventListener("mouseleave",()=>{window.hideTooltip&&window.innerWidth>=640&&window.hideTooltip()}),this.resetTutorialBtn.addEventListener("mouseenter",()=>{window.showTooltip&&window.innerWidth>=640&&window.showTooltip("Reset tutorial",this.resetTutorialBtn)}),this.resetTutorialBtn.addEventListener("mouseleave",()=>{window.hideTooltip&&window.innerWidth>=640&&window.hideTooltip()}),this.toggleBtn.addEventListener("mouseenter",()=>{if(window.showTooltip&&window.innerWidth>=640){const e=this.isOpen?"Close side panel":"Open side panel";window.showTooltip(e,this.toggleBtn)}}),this.toggleBtn.addEventListener("mouseleave",()=>{window.hideTooltip&&window.innerWidth>=640&&window.hideTooltip()}),this.closeBtn.addEventListener("mouseenter",()=>{window.showTooltip&&window.innerWidth>=640&&window.showTooltip("Close side panel",this.closeBtn)}),this.closeBtn.addEventListener("mouseleave",()=>{window.hideTooltip&&window.innerWidth>=640&&window.hideTooltip()})}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen=!0,this.sidenav.classList.remove("translate-x-full"),this.sidenav.classList.add("translate-x-0"),this.updateToggleButton()}close(){this.isOpen=!1,this.sidenav.classList.remove("translate-x-0"),this.sidenav.classList.add("translate-x-full"),this.updateToggleButton(),window.hideTooltip&&window.hideTooltip()}updateToggleButton(){const e=this.toggleBtn.querySelector("svg path");this.isOpen?(e.setAttribute("d","M15 19l-7-7 7-7"),this.toggleBtn.setAttribute("title","Close side panel"),this.toggleBtn.setAttribute("aria-label","Close side panel")):(e.setAttribute("d","M9 5l7 7-7 7"),this.toggleBtn.setAttribute("title","Open side panel"),this.toggleBtn.setAttribute("aria-label","Open side panel"))}async resetTutorial(){try{await ie("tutorialSeen",!1),window.showTooltip&&(window.showTooltip("Tutorial reset! Reload page to see tutorial.",this.resetTutorialBtn),setTimeout(()=>{window.hideTooltip&&window.hideTooltip()},3e3)),setTimeout(()=>{confirm("Tutorial has been reset! Would you like to reload the page to see the tutorial?")&&window.location.reload()},500)}catch(e){console.error("Error resetting tutorial:",e),window.showTooltip&&(window.showTooltip("Error resetting tutorial. Please try again.",this.resetTutorialBtn),setTimeout(()=>{window.hideTooltip&&window.hideTooltip()},3e3))}}openAppInfoModal(){this.appInfoModal&&(this.appInfoModal.classList.remove("hidden"),this.appInfoModal.setAttribute("aria-hidden","false"),this.close(),setTimeout(()=>{this.closeAppInfoBtn.focus()},100))}closeAppInfoModal(){this.appInfoModal&&(this.appInfoModal.classList.add("hidden"),this.appInfoModal.setAttribute("aria-hidden","true"),this.infoBtn.focus())}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.sidenavManager=new Me}):window.sidenavManager=new Me;const T=document.getElementById("soundCanvas"),g=T.getContext("2d"),C=window.devicePixelRatio||1;let H=new Map;const z=new Audio("./assets/5.mp3"),U=[{dirX:0,dirY:-1,audio:new Audio("./assets/2.mp3")},{dirX:0,dirY:1,audio:new Audio("./assets/8.mp3")},{dirX:-1,dirY:0,audio:new Audio("./assets/4.mp3")},{dirX:1,dirY:0,audio:new Audio("./assets/6.mp3")},{dirX:1/Math.SQRT2,dirY:-1/Math.SQRT2,audio:new Audio("./assets/3.mp3")},{dirX:-1/Math.SQRT2,dirY:-1/Math.SQRT2,audio:new Audio("./assets/1.mp3")},{dirX:-1/Math.SQRT2,dirY:1/Math.SQRT2,audio:new Audio("./assets/7.mp3")},{dirX:1/Math.SQRT2,dirY:1/Math.SQRT2,audio:new Audio("./assets/9.mp3")}];function Ke(){const n=T.clientWidth,e=T.clientHeight;T.width=n*C,T.height=e*C,g.resetTransform(),g.scale(C,C)}function Ze(){Ke();const n=T.clientWidth,e=T.clientHeight,t=n/2,i=e/2,o=Math.min(n,e),s=.4,a=o*.15*s,r=a*.4,c=a+r+o*.12*s;if(g.clearRect(0,0,n,e),g.beginPath(),g.arc(t,i,a,0,Math.PI*2),g.lineWidth=r,H.has(-1)){const{startTime:d,duration:u}=H.get(-1),h=ve(d,u);if(h>0){const m=Math.floor(255*h),w=Math.floor(107*h),y=Math.floor(107*h);g.strokeStyle=`rgb(${m}, ${w}, ${y})`}else{const m=window.themeManager?window.themeManager.getEffectiveTheme():"light";g.strokeStyle=m==="dark"?"#fff":"#000",H.delete(-1)}}else{const d=window.themeManager?window.themeManager.getEffectiveTheme():"light";g.strokeStyle=d==="dark"?"#fff":"#000"}g.stroke(),[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0},{x:1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:-1/Math.SQRT2},{x:1/Math.SQRT2,y:1/Math.SQRT2},{x:-1/Math.SQRT2,y:1/Math.SQRT2}].forEach((d,u)=>{for(let h=1;h<=3;h++){const m=t+d.x*c*h,w=i+d.y*c*h,y=u*3+(h-1);if(g.beginPath(),g.arc(m,w,r,0,Math.PI*2),H.has(y)){const{startTime:p,duration:E}=H.get(y),b=ve(p,E);if(b>0){const S=Math.floor(255*b),P=Math.floor(107*b),A=Math.floor(107*b);g.fillStyle=`rgb(${S}, ${P}, ${A})`,g.fill(),g.strokeStyle="#fff",g.lineWidth=2,g.stroke()}else{H.delete(y);const S=window.themeManager?window.themeManager.getEffectiveTheme():"light";g.fillStyle=S==="dark"?"#fff":"#000",g.fill()}}else{const p=window.themeManager?window.themeManager.getEffectiveTheme():"light";g.fillStyle=p==="dark"?"#fff":"#000",g.fill()}}})}let j=[];const et=.006,tt=.016;T.addEventListener("click",n=>{const e=T.getBoundingClientRect(),t=T.clientWidth,i=T.clientHeight,o=n.clientX-e.left,s=n.clientY-e.top,a=t/2,r=i/2,c=Math.min(t,i),l=.4,d=c*.15*l;if((o-a)**2+(s-r)**2<=d*d){v.canvasRipple(T,o,s),M.trigger("medium"),j.push({x:a,y:r,radius:d,alpha:1}),z.currentTime=0,z.play();return}const u=d*.4,h=d+u+c*.12*l;for(const{dirX:m,dirY:w,audio:y}of U)for(let p=1;p<=3;p++){const E=a+m*h*p,b=r+w*h*p;if((o-E)**2+(s-b)**2<=u*u){v.canvasRipple(T,o,s),M.trigger("light"),y.currentTime=0,y.play();return}}});function nt(){const e=Math.min(T.clientWidth,T.clientHeight)*et,i=(window.themeManager?window.themeManager.getEffectiveTheme():"light")==="dark"?"255,255,255":"0,0,0";j.forEach((o,s)=>{g.beginPath(),g.arc(o.x,o.y,o.radius,0,Math.PI*2),g.strokeStyle=`rgba(${i},${o.alpha})`,g.lineWidth=2,g.stroke(),o.radius+=e,o.alpha-=tt,o.alpha<=0&&j.splice(s,1)})}function xe(){Ze(),nt(),requestAnimationFrame(xe)}function it(n,e=500){const t=Date.now();H.set(n,{startTime:t,duration:e})}function ot(){H.clear()}window.canvasHighlight={highlightCircle:it,clearAllHighlights:ot};function ve(n,e){const t=Date.now()-n,i=Math.min(t/e,1),o=4,s=Math.max(0,1-i),a=Math.sin(t*o/100)*.3+.7;return s*a}xe();const le={ZERO:0,ONE:.25,TWO:.5,THREE:.75},st=.01;let re=null;function qe(){return re||(re=new(window.AudioContext||window.webkitAudioContext)),re}function Ie(n){const e=Math.floor(n/3),t=n%3;return{radian:t+1,direction:e,position:t}}function at(n){const e=Math.floor(n/3);return U[e]?U[e].audio:null}function rt(){if(j&&T){const n=T.clientWidth/2,e=T.clientHeight/2,o=Math.min(T.clientWidth,T.clientHeight)*.15*.4;j.push({x:n,y:e,radius:o,alpha:1})}}async function ee(n,e={}){if(!n||n.length===0){console.warn("No sequence to play");return}const{inModal:t=!1}=e,i=qe();i.state==="suspended"&&await i.resume(),window.canvasHighlight&&window.canvasHighlight.clearAllHighlights(),t&&window.modalHighlight&&window.modalHighlight.clearModalHighlights();const o={0:[],1:[],2:[],3:[]};n.forEach(s=>{const{radian:a}=Ie(s);o[a].push(s)}),rt(),t&&window.modalHighlight&&window.modalHighlight.createModalRipple(),z&&setTimeout(()=>{z.currentTime=0,z.play().catch(s=>console.warn("Failed to play droplet sound:",s)),window.canvasHighlight&&window.canvasHighlight.highlightCircle(-1,400),t&&window.modalHighlight&&window.modalHighlight.highlightModalCircle(-1,400)},0),Object.keys(o).forEach(s=>{const a=o[s];if(a.length===0)return;const r=parseInt(s),c=le[Object.keys(le)[r]]*1e3;a.forEach((l,d)=>{const u=at(l);if(u){const h=c+d*st*1e3;setTimeout(()=>{u.currentTime=0,u.play().catch(m=>console.warn(`Failed to play audio for circle ${l}:`,m)),M.radianFeedback(r),window.canvasHighlight&&window.canvasHighlight.highlightCircle(l,600),t&&window.modalHighlight&&window.modalHighlight.highlightModalCircle(l,600)},h)}})})}const te=5;let W=new Map;function Ce(n,e){return n||JSON.stringify(e)}function fe(n,e,t=null){const i=Ce(t,n);if(W.has(i)){const o=W.get(i);clearInterval(o.timer),W.delete(i),console.log("ðŸ”„ Loop playback stopped for thumbnail"),de(),J()}else{if(W.size>=te){console.warn(`ðŸ”„ Maximum number of concurrent loops (${te}) reached. Cannot start new loop.`);const s=document.getElementById("loopCounter");if(s){const a=s.className;s.className=s.className.replace(/bg-\S+/g,"bg-red-200 dark:bg-red-800"),s.style.animation="pulse 0.5s ease-in-out 2",setTimeout(()=>{s.className=a,s.style.animation=""},1e3)}return}console.log(`ðŸ”„ Starting loop playback every ${e}s`),ee(n);const o=setInterval(async()=>{try{await ee(n)}catch(s){console.error("Error in loop playback:",s),fe(n,e,t)}},e*1e3);W.set(i,{timer:o,sequence:n,interval:e,thumbnail:t}),console.log("ðŸ”„ Loop playback started"),de(),J()}}function Be(n,e=null){if(!n)return!1;const t=Ce(e,n);return W.has(t)}function J(){const n=document.getElementById("loopCounter");if(!n)return;const e=W.size;e>0?(n.textContent=`Loops playing: ${e}/${te}`,n.classList.remove("hidden")):n.classList.add("hidden")}function de(){const n=document.getElementById("sequenceBar");if(!n)return;n.querySelectorAll("canvas").forEach(t=>{const i=t.sequenceData;if(i){const o=Be(i.seq,t),s=document.documentElement.classList.contains("dark");t.classList.remove("bg-swarmstripe-200/50","bg-swarmshadow-50","rounded-lg","transition-colors","duration-300","ease-in-out","loop-pulse-animation","p-2"),t.style.backgroundColor="",t.style.animation="",o&&(t.classList.add("rounded-full","transition-colors","duration-300","ease-in-out","loop-pulse-animation","p-2"),s?t.classList.add("bg-swarmshadow-50"):t.classList.add("bg-swarmstripe-200/50"),t.style.animation="loop-pulse 2s ease-in-out infinite")}})}function he(){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",he);return}const n=document.getElementById("sequenceBar");if(!n){console.warn("Sequence bar not found, retrying..."),setTimeout(he,100);return}n.addEventListener("click",async e=>{const t=e.target.closest("canvas");if(!t)return;v.bounce(t,1.1,120),M.trigger("light");let i;if(t.sequenceData)i=t.sequenceData;else{const r=Array.from(n.children).indexOf(t);try{i=(await N())[r]}catch(c){console.error("Error loading sequence:",c);return}}if(!i)return;let o,s,a;Array.isArray(i)?(o=i,s=!1,a=3):(o=i.seq||i.sequence,s=i.isLoop||!1,a=i.loopInterval||3);try{s?fe(o,a,t):await ee(o)}catch(r){console.error("Error playing sequence:",r)}})}he();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",J):J();window.audioSystem={playSequence:ee,initAudioContext:qe,toggleLoopPlayback:fe,isSequenceLooping:Be,updateThumbnailLoopStates:de,updateLoopCounter:J,getRadianInfo:Ie,RADIAN_TIMING:le,MAX_CONCURRENT_LOOPS:te,getActiveLoopCount:()=>W.size};const x=document.getElementById("tooltip");function Ae(n,e,t=0){const i=e.getBoundingClientRect(),o=window.innerWidth,s=window.innerHeight;x.textContent=n;const a=e.closest("#sequenceModal")!==null,r=window.__TAURI__!==void 0;let c,l;if(a||o<640){const d=x.offsetWidth||200;if(a){const h=document.getElementById("modalContent").getBoundingClientRect();c=h.left+(h.width-d)/2,l=h.top-40,l<16&&(l=h.top+8)}else c=(o-d)/2,l=i.bottom+8;c=Math.max(8,Math.min(c,o-d-8)),l=Math.max(8,Math.min(l,s-50))}else if(c=i.left+i.width/2-x.offsetWidth/2+t,l=i.bottom+16,r){const d=x.offsetWidth||200,u=x.offsetHeight||40;c=Math.max(16,Math.min(c,o-d-16)),l=Math.max(16,Math.min(l,s-u-16));const h=i.left+i.width/2;Math.abs(c+d/2-h)>100&&(c=h-d/2,c=Math.max(16,Math.min(c,o-d-16)))}else{const d=x.offsetWidth||200;c=Math.max(8,Math.min(c,o-d-8))}x.style.left=c+"px",x.style.top=l+"px",x.classList.remove("hidden"),x.removeAttribute("aria-hidden")}function Re(){x.classList.add("hidden"),x.setAttribute("aria-hidden","true")}window.showTooltip=Ae;window.hideTooltip=Re;window.showTooltip=Ae;window.hideTooltip=Re;function ce(){if(window.themeManager){const n=window.themeManager.getEffectiveTheme(),e=document.documentElement.classList.contains("dark");if(n==="dark"&&e||n==="light"&&!e)return n}return document.documentElement.classList.contains("dark")?"dark":document.documentElement.classList.contains("light")?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}async function ne(n){var E;const e=document.getElementById("sequenceBar"),t=80,i=document.createElement("canvas");i.width=t*C,i.height=t*C,i.style.width=t+"px",i.style.height=t+"px";const o=i.getContext("2d");o.scale(C,C);let s,a,r;Array.isArray(n)?(s=n,a=!1,r=3):(s=n.sequence||n,a=n.isLoop||!1,r=n.loopInterval||3);const c=3,l=t-c,d=t/2,u=t/2,h=l*.08,m=h*.35,w=h*1.8;o.beginPath(),o.arc(d,u,h,0,2*Math.PI);const y=ce(),p=y==="dark"?"#fff":"#000";if(window.location.hostname==="localhost"&&console.log("Thumbnail generation - Effective theme:",y,"Center color:",p,"DOM dark class:",document.documentElement.classList.contains("dark"),"Theme manager available:",!!window.themeManager,"Theme manager theme:",(E=window.themeManager)==null?void 0:E.getEffectiveTheme()),o.fillStyle=p,o.fill(),U.forEach(({dirX:b,dirY:S,audio:P},A)=>{for(let R=1;R<=3;R++){const He=[0,1,2,3,4,5,7,6].indexOf(A)*3+(R-1),We=s.includes(He),se=d+b*w*R,ae=u+S*w*R;if(se-m>=c&&se+m<=t-c&&ae-m>=c&&ae+m<=t-c){o.beginPath(),o.arc(se,ae,m,0,2*Math.PI);const pe=ce(),Qe=pe==="dark"?"#fff":"#000",_e=pe==="dark"?"#000":"#fff";o.fillStyle=Qe,o.strokeStyle=_e,o.lineWidth=.5,We?o.fill():o.stroke()}}}),i.sequenceData={seq:s,isLoop:a,loopInterval:r},window.audioSystem&&window.audioSystem.isSequenceLooping&&window.audioSystem.isSequenceLooping(s,i)){const S=ce()==="dark";i.classList.add("rounded-full","transition-colors","duration-300","ease-in-out","p-2"),S?i.classList.add("bg-swarmshadow-50"):i.classList.add("bg-swarmstripe-200/50"),i.style.animation="loop-pulse 2s ease-in-out infinite"}e.appendChild(i)}function ct(){N().then(n=>{n.forEach(e=>ne(e)),console.log(`âœ… Loaded ${n.length} saved sequences`)}).catch(n=>{console.error("Failed to load sequences:",n)})}function Se(){document.getElementById("sequenceBar").querySelectorAll("canvas").forEach(t=>t.remove()),N().then(t=>{t.forEach(i=>ne(i))}).catch(t=>{console.error("Failed to reload sequences after theme change:",t)})}function lt(){if(window.themeManager&&window.themeManager.initialized){const n=window.themeManager.setTheme.bind(window.themeManager);window.themeManager.setTheme=async function(e){await n(e),Se()}}else window.addEventListener("themeManagerReady",()=>{const n=window.themeManager.setTheme.bind(window.themeManager);window.themeManager.setTheme=async function(e){await n(e),Se()}},{once:!0})}document.addEventListener("DOMContentLoaded",lt);function Ee(){function n(){if(window.themeManager&&window.themeManager.initialized){const e=window.themeManager.getEffectiveTheme(),t=document.documentElement.classList.contains("dark"),i=document.documentElement.classList.contains("light");e==="dark"&&t||e==="light"&&(i||!t&&!i)?ct():requestAnimationFrame(n)}else window.addEventListener("themeManagerReady",()=>{requestAnimationFrame(n)},{once:!0})}n()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ee):Ee();class dt{constructor(){this.contextMenu=null,this.currentThumbnail=null,this.init()}init(){this.contextMenu=document.getElementById("contextMenu"),this.setupEventListeners()}setupEventListeners(){document.addEventListener("click",t=>{this.contextMenu.contains(t.target)||this.hideContextMenu()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&this.hideContextMenu()}),document.getElementById("editSequence").addEventListener("click",()=>{v.press(document.getElementById("editSequence"),.95,100),M.trigger("light"),this.editSequence(),this.hideContextMenu()}),document.getElementById("deleteSequence").addEventListener("click",()=>{v.press(document.getElementById("deleteSequence"),.95,100),M.trigger("medium"),this.deleteSequence(),this.hideContextMenu()});const e=document.getElementById("sequenceBar");e&&e.addEventListener("contextmenu",t=>{const i=t.target.closest("canvas");i&&i.sequenceData&&(t.preventDefault(),this.showContextMenu(t,i))})}showContextMenu(e,t){this.currentThumbnail=t,this.contextMenu.style.visibility="hidden",this.contextMenu.classList.remove("hidden");const i=this.contextMenu.getBoundingClientRect(),o=i.width,s=i.height,a=window.innerWidth,r=window.innerHeight;let c=e.clientX,l=e.clientY;const d=8;c+o+d>a&&(c=c-o,c<d&&(c=a-o-d)),c=Math.max(d,c),l+s+d>r&&(l=l-s,l<d&&(l=r-s-d)),l=Math.max(d,l);const u=document.getElementById("sequenceBar");if(u){const h=u.getBoundingClientRect();e.clientY>=h.top&&l+s>h.top&&(l=Math.max(d,h.top-s-4))}this.contextMenu.style.left=c+"px",this.contextMenu.style.top=l+"px",this.contextMenu.style.visibility="visible"}hideContextMenu(){this.contextMenu.classList.add("hidden"),this.contextMenu.style.visibility="",this.currentThumbnail=null}editSequence(){if(!this.currentThumbnail||!this.currentThumbnail.sequenceData)return;const e=this.currentThumbnail.sequenceData;this.currentThumbnail.setAttribute("data-editing","true"),window.modalManager&&window.modalManager.openEditMode(e,this.currentThumbnail)}async deleteSequence(){if(!this.currentThumbnail||!this.currentThumbnail.sequenceData)return;const e=this.currentThumbnail,t=this.currentThumbnail.sequenceData;if(confirm("Are you sure you want to delete this sequence? This action cannot be undone."))try{const s=(await N()).findIndex(a=>{const r=Array.isArray(a)?a:a.sequence||a.seq,c=Array.isArray(t)?t:t.sequence||t.seq;return JSON.stringify(r)===JSON.stringify(c)});if(s!==-1){if(await Je(s),e.remove(),window.audioSystem&&window.audioSystem.isSequenceLooping){const a=Array.isArray(t)?t:t.sequence||t.seq;if(window.audioSystem.isSequenceLooping(a,e)){const r=t.loopInterval||3;window.audioSystem.toggleLoopPlayback(a,r,e)}}console.log("âœ… Sequence deleted successfully")}else console.error("âŒ Sequence not found in storage"),alert("Sequence not found in storage. It may have already been deleted.")}catch(o){console.error("âŒ Failed to delete sequence:",o),alert("Failed to delete sequence. Please try again.")}}}document.addEventListener("DOMContentLoaded",()=>{window.contextMenuManager=new dt});const X=document.getElementById("createSequenceBtn"),D=document.getElementById("sequenceModal"),L=document.getElementById("sequenceCanvas"),f=L.getContext("2d"),be=document.getElementById("modalTitle");let O=new Map,V=[];const ht=4,ut=.04;class De{constructor(){this.isEditMode=!1,this.editingThumbnail=null,this.originalSequenceData=null,this.init()}init(){this.setupEventListeners()}setupEventListeners(){X.addEventListener("click",()=>{v.bounce(X,1.05,150),M.trigger("medium"),this.openCreateMode()})}async openCreateMode(){hideTooltip(),X.classList.remove("highlight-once"),document.body.classList.remove("tutorial-active"),this.isEditMode=!1,this.editingThumbnail=null,this.originalSequenceData=null,be.textContent="Create New Sequence",B=!await me("tutorialSeen"),B?(Z.classList.remove("hidden"),ft.textContent=Y,Pe.textContent="0"):Z.classList.add("hidden"),this.resetModalState(),this.showModal()}openEditMode(e,t){this.isEditMode=!0,this.editingThumbnail=t,this.originalSequenceData=JSON.parse(JSON.stringify(e)),be.textContent="Edit Sequence",B=!1,Z.classList.add("hidden"),this.resetModalState(),this.showModal(),this.loadSequenceIntoModal(e),K(),ue()}resetModalState(){I.forEach(t=>{t.clicked=!1}),F.checked=!1,Q.value=3,G.style.opacity="0.5",Q.disabled=!0,O.clear(),V.length=0;const e=document.getElementById("modalInstruction");e&&e.classList.add("hidden")}loadSequenceIntoModal(e){const t=Array.isArray(e)?e:e.seq||e.sequence||[],i=e.isLoop||!1,o=e.loopInterval||3;F.checked=i,Q.value=o,i&&(G.style.opacity="1",Q.disabled=!1),t.forEach(s=>{I[s]&&(I[s].clicked=!0)})}showModal(){D.classList.remove("hidden"),D.classList.add("flex"),D.setAttribute("aria-hidden","false"),this.initializeModalCircles(),K(),ge(),B&&Oe(),ue()}initializeModalCircles(){const e=L.clientWidth,t=L.clientHeight,i=250,o=(e-i)/2,s=(t-i)/2,a=i/2,r=i/2,c=i*.09,l=c*.3,d=c+l*2,u=[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0},{x:1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:-1/Math.SQRT2},{x:1/Math.SQRT2,y:1/Math.SQRT2},{x:-1/Math.SQRT2,y:1/Math.SQRT2}];I=[],u.forEach((h,m)=>{const y=U[[0,1,2,3,4,5,7,6][m]].audio;for(let p=1;p<=3;p++)I.push({x:o+a+h.x*d*p,y:s+r+h.y*d*p,r:l,audio:y,clicked:!1})})}}function mt(){const n=L.clientWidth,e=L.clientHeight;L.width=n*C,L.height=e*C,f.resetTransform(),f.scale(C,C)}const q=document.getElementById("testSequenceBtn"),_=document.getElementById("saveSequenceBtn"),Z=document.getElementById("tutorialCounter"),ft=document.getElementById("targetCount"),Pe=document.getElementById("selectedCount"),F=document.getElementById("loopToggle"),Q=document.getElementById("loopInterval"),G=document.getElementById("loopIntervalControls");let I=[],B=!1;const Y=5;async function gt(){try{const n=await me("tutorialSeen"),e=await N();!n&&e.length===0&&(document.body.classList.add("tutorial-active"),X.classList.add("highlight-once"),showTooltip("Start playing by clicking New Sequence!",X))}catch(n){console.log("Could not check tutorial state:",n)}}setTimeout(gt,100);const wt=new De;window.modalManager=wt;function K(){mt();const n=L.clientWidth,e=L.clientHeight,t=Math.min(250,250);f.clearRect(0,0,n,e),f.save();const i=(n-t)/2,o=(e-t)/2;f.translate(i,o);const s=t/2,a=t/2;pt();const r=t*.09;if(f.beginPath(),f.arc(s,a,r,0,2*Math.PI),O.has(-1)){const{startTime:u,duration:h}=O.get(-1),m=ke(u,h);if(m>0){const w=Math.floor(255*m),y=Math.floor(107*m),p=Math.floor(107*m);f.fillStyle=`rgb(${w}, ${y}, ${p})`}else{const w=window.themeManager?window.themeManager.getEffectiveTheme():"light";f.fillStyle=w==="dark"?"#fff":"#000",O.delete(-1)}}else{const u=window.themeManager?window.themeManager.getEffectiveTheme():"light";f.fillStyle=u==="dark"?"#fff":"#000"}f.fill();const c=r*.3,l=r+c*2;[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0},{x:1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:-1/Math.SQRT2},{x:1/Math.SQRT2,y:1/Math.SQRT2},{x:-1/Math.SQRT2,y:1/Math.SQRT2}].forEach((u,h)=>{var m;for(let w=1;w<=3;w++){const y=s+u.x*l*w,p=a+u.y*l*w,E=h*3+(w-1);f.beginPath(),f.arc(y,p,c,0,2*Math.PI);const b=(m=I[E])==null?void 0:m.clicked;if(O.has(E)){const{startTime:S,duration:P}=O.get(E),A=ke(S,P);if(A>0){const R=Math.floor(255*A),k=Math.floor(107*A),we=Math.floor(107*A);f.fillStyle=`rgb(${R}, ${k}, ${we})`,f.fill(),f.strokeStyle="#fff",f.lineWidth=2,f.stroke()}else{O.delete(E);const k=(window.themeManager?window.themeManager.getEffectiveTheme():"light")==="dark"?"#fff":"#000";b?(f.fillStyle=k,f.fill()):(f.strokeStyle=k,f.lineWidth=2,f.stroke())}}else{const P=(window.themeManager?window.themeManager.getEffectiveTheme():"light")==="dark"?"#fff":"#000";b?(f.fillStyle=P,f.fill()):(f.strokeStyle=P,f.lineWidth=2,f.stroke())}}}),f.restore()}function pt(n,e,t,i){const s=(window.themeManager?window.themeManager.getEffectiveTheme():"light")==="dark"?"255,255,255":"0,0,0";V.forEach((a,r)=>{f.beginPath(),f.arc(a.x,a.y,a.radius,0,Math.PI*2),f.strokeStyle=`rgba(${s},${a.alpha})`,f.lineWidth=2,f.stroke(),a.radius+=ht,a.alpha-=ut,a.alpha<=0&&V.splice(r,1)})}function yt(n,e=600){const t=Date.now();O.set(n,{startTime:t,duration:e})}function Tt(){O.clear()}function Mt(){V.push({x:125,y:125,radius:22.5,alpha:1})}function ge(){D.classList.contains("hidden")||(K(),requestAnimationFrame(ge))}window.modalHighlight={highlightModalCircle:yt,clearModalHighlights:Tt,createModalRipple:Mt,startAnimation:ge};L.addEventListener("click",async n=>{const e=L.getBoundingClientRect(),t=n.clientX-e.left,i=n.clientY-e.top,o=L.clientWidth,s=L.clientHeight,a=250,r=(o-a)/2,c=(s-a)/2,l=t-r,d=i-c,u=a/2,h=a/2,m=a*.09,w=m*.3,y=m+w*2;[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0},{x:1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:-1/Math.SQRT2},{x:1/Math.SQRT2,y:1/Math.SQRT2},{x:-1/Math.SQRT2,y:1/Math.SQRT2}].forEach((E,b)=>{for(let S=1;S<=3;S++){const P=u+E.x*y*S,A=h+E.y*y*S,R=b*3+(S-1),k=I[R];if(k&&(l-P)**2+(d-A)**2<=w*w){k.clicked=!k.clicked,v.canvasRipple(L,t,i),M.trigger(k.clicked?"medium":"light"),k.clicked&&(k.audio.currentTime=0,k.audio.play()),ue(),K();return}}})});function ue(){const n=I.filter(e=>e.clicked).length;B?(n===Y?(q.disabled=!1,q.classList.add("highlight-once"),showTooltip("Click Test to hear what your sequence sounds like!",q)):(q.disabled=!0,q.classList.remove("highlight-once"),hideTooltip()),Oe()):n>0?(q.disabled=!1,_.disabled=!1):(q.disabled=!0,_.disabled=!0)}function Oe(){if(!B)return;const n=I.filter(t=>t.clicked).length;Pe.textContent=n;const e=document.getElementById("modalInstruction");if(n===0)e.textContent="Click the empty circles to form your sequence",e.classList.remove("hidden"),hideTooltip();else if(n<Y){const t=Y-n;e.textContent=`Select ${t} more circle${t===1?"":"s"}`,e.classList.remove("hidden"),hideTooltip()}else n===Y&&(e.classList.add("hidden"),hideTooltip())}q.addEventListener("click",async n=>{v.press(q,.95,100),M.trigger("medium"),hideTooltip(),q.classList.remove("highlight-once");const e=I.map((t,i)=>t.clicked?i:null).filter(t=>t!==null);if(e.length>0)try{window.audioSystem&&window.audioSystem.playSequence?await window.audioSystem.playSequence(e,{inModal:!0}):console.warn("Audio system not available, falling back to basic feedback"),B&&(_.disabled=!1),B&&(await ie("tutorialSeen",!0),B=!1)}catch(t){console.error("Error playing test sequence:",t),B&&(_.disabled=!1)}});F.addEventListener("change",()=>{const n=F.checked;Q.disabled=!n,n?G.classList.remove("opacity-50"):G.classList.add("opacity-50")});_.addEventListener("click",async()=>{v.press(_,.95,100),M.trigger("success");const n=I.map((o,s)=>o.clicked?s:null).filter(o=>o!==null),e=F.checked,t=parseInt(Q.value)||3,i={sequence:n,isLoop:e,loopInterval:t};try{if(window.modalManager.isEditMode){const o=await N(),s=Array.isArray(window.modalManager.originalSequenceData)?window.modalManager.originalSequenceData:window.modalManager.originalSequenceData.sequence||window.modalManager.originalSequenceData.seq,a=o.findIndex(r=>{const c=Array.isArray(r)?r:r.sequence||r.seq;return JSON.stringify(c)===JSON.stringify(s)});if(a!==-1){if(await je(a,i),window.audioSystem&&window.audioSystem.isSequenceLooping&&window.audioSystem.isSequenceLooping(s,window.modalManager.editingThumbnail)){const r=window.modalManager.originalSequenceData.loopInterval||3;window.audioSystem.toggleLoopPlayback(s,r,window.modalManager.editingThumbnail)}window.modalManager.editingThumbnail.removeAttribute("data-editing"),window.modalManager.editingThumbnail.remove(),ne(i),console.log("âœ… Sequence updated successfully")}else throw new Error("Original sequence not found in storage")}else await Ye(i),ne(i),console.log("âœ… New sequence saved successfully");B&&await ie("tutorialSeen",!0),oe()}catch(o){console.error("âŒ Failed to save sequence:",o),alert("Failed to save sequence. Please try again.")}});function oe(){hideTooltip(),D.classList.add("hidden"),D.classList.remove("flex"),D.setAttribute("aria-hidden","true"),window.modalManager.isEditMode&&window.modalManager.editingThumbnail&&window.modalManager.editingThumbnail.removeAttribute("data-editing"),window.modalManager.isEditMode=!1,window.modalManager.editingThumbnail=null,window.modalManager.originalSequenceData=null,I.forEach(e=>e.clicked=!1),q.disabled=!0,q.classList.remove("highlight-once"),_.disabled=!0,Z.classList.add("hidden"),B=!1;const n=document.getElementById("modalInstruction");n&&n.classList.add("hidden"),F.checked=!1,Q.value=3,Q.disabled=!0,G.style.opacity="0.5",window.modalHighlight&&window.modalHighlight.clearModalHighlights(),V.length=0,K()}const Le=document.getElementById("closeModalBtn");Le.addEventListener("click",()=>{v.press(Le,.9,100),M.trigger("light"),oe()});D.addEventListener("click",n=>{n.target===D&&oe()});const vt=document.getElementById("modalContent");vt.addEventListener("click",n=>{n.stopPropagation()});document.addEventListener("keydown",n=>{n.key==="Escape"&&!D.classList.contains("hidden")&&oe()});function ke(n,e){const t=Date.now()-n,i=Math.min(t/e,1),o=4,s=Math.max(0,1-i),a=Math.sin(t*o/100)*.3+.7;return s*a}window.modalManager=new De;(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.protocol==="file:")&&Ne(()=>import("./dev-tools-CCLl7-Tw.js"),[]).catch(n=>{console.log("Dev tools not loaded (production build)")});console.log("ðŸŽµ Swarm Rippler app initialized");export{$ as o,ie as s};
