(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();const Xe="modulepreload",ze=function(n){return"/"+n},be={},Ye=function(e,t,i){let o=Promise.resolve();if(t&&t.length>0){let a=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),l=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));o=a(t.map(c=>{if(c=ze(c),c in be)return;be[c]=!0;const d=c.endsWith(".css"),m=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${m}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":Xe,d||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((g,p)=>{h.addEventListener("load",g),h.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return o.then(a=>{for(const r of a||[])r.status==="rejected"&&s(r.reason);return e().catch(s)})},Ue="clickRippleDB",je=1;function J(){return new Promise((n,e)=>{const t=indexedDB.open(Ue,je);t.onupgradeneeded=i=>{const o=i.target.result;o.objectStoreNames.contains("settings")||o.createObjectStore("settings"),o.objectStoreNames.contains("sequences")||o.createObjectStore("sequences",{autoIncrement:!0})},t.onsuccess=i=>n(i.target.result),t.onerror=i=>e(i.target.error)})}async function ye(n){const e=await J();return new Promise(t=>{const o=e.transaction("settings","readonly").objectStore("settings").get(n);o.onsuccess=()=>t(o.result),o.onerror=()=>t(null)})}async function fe(n,e){(await J()).transaction("settings","readwrite").objectStore("settings").put(e,n)}async function Je(n){const t=(await J()).transaction("sequences","readwrite");let i;Array.isArray(n)?i={sequence:n,isLoop:!1,loopInterval:3}:i=n,t.objectStore("sequences").add(i)}async function K(){const n=await J();return new Promise(e=>{const i=n.transaction("sequences","readonly").objectStore("sequences").getAll();i.onsuccess=()=>e(i.result||[]),i.onerror=()=>e([])})}async function Ee(){return await ye("preferences")||{theme:"system",volume:.7,showTutorial:!0}}async function Ke(n){await fe("preferences",n)}async function Ve(n,e){const o=(await J()).transaction("sequences","readwrite").objectStore("sequences");return new Promise((s,a)=>{const r=o.getAll();r.onsuccess=()=>{const l=r.result||[];if(n>=0&&n<l.length){const c=o.put(e,n+1);c.onsuccess=()=>{console.log("Sequence updated successfully"),s()},c.onerror=()=>{console.error("Failed to update sequence:",c.error),a(c.error)}}else a(new Error("Invalid sequence index"))},r.onerror=()=>{console.error("Failed to get sequences for update:",r.error),a(r.error)}})}async function Ge(n){const i=(await J()).transaction("sequences","readwrite").objectStore("sequences");return new Promise((o,s)=>{const a=i.getAll();a.onsuccess=()=>{const r=a.result||[];if(n>=0&&n<r.length){const l=i.clear();l.onsuccess=()=>{const c=r.filter((m,h)=>h!==n);let d=0;if(c.length===0){console.log("Sequence deleted successfully (store now empty)"),o();return}c.forEach((m,h)=>{const g=i.add(m,h+1);g.onsuccess=()=>{d++,d===c.length&&(console.log("Sequence deleted successfully"),o())},g.onerror=()=>{console.error("Failed to re-add sequence:",g.error),s(g.error)}})},l.onerror=()=>{console.error("Failed to clear store for deletion:",l.error),s(l.error)}}else s(new Error("Invalid sequence index"))},a.onerror=()=>{console.error("Failed to get sequences for deletion:",a.error),s(a.error)}})}class Ze{constructor(){this.isSupported=this.checkSupport()}checkSupport(){var e;return!!(navigator.vibrate||window.DeviceMotionEvent||window.TapticEngine||(e=window.__TAURI__)!=null&&e.invoke)}trigger(e="light",t=.5){var s;if(!this.isSupported)return;const i={light:[10],medium:[20],heavy:[40],radian:[15,10,15],select:[8],success:[25,15,25]},o=i[e]||i.light;try{navigator.vibrate?navigator.vibrate(o):window.TapticEngine?window.TapticEngine.impact({style:e}):(s=window.__TAURI__)!=null&&s.invoke&&window.__TAURI__.invoke("haptic_feedback",{type:e,intensity:t})}catch(a){console.debug("Haptic feedback not available:",a)}}radianFeedback(e){const t=[.3,.5,.7],i=e%3;this.trigger("radian",t[i])}}class b{static bounce(e,t=1.05,i=150){e&&(e.style.transition=`transform ${i}ms cubic-bezier(0.68, -0.55, 0.265, 1.55)`,e.style.transform=`scale(${t})`,setTimeout(()=>{e.style.transform="scale(1)",setTimeout(()=>{e.style.transition="",e.style.transform=""},i)},i))}static press(e,t=.95,i=100){e&&(e.style.transition=`transform ${i}ms ease-out`,e.style.transform=`scale(${t})`,setTimeout(()=>{e.style.transform="scale(1)",setTimeout(()=>{e.style.transition="",e.style.transform=""},i)},i))}static pulse(e,t=null,i=300){if(!e)return;t||(t=document.documentElement.classList.contains("dark")?"rgba(255, 241, 118, 0.6)":"rgba(255, 235, 59, 0.6)");const o=e.style.boxShadow;e.style.transition=`box-shadow ${i}ms ease-out`,e.style.boxShadow=`0 0 20px 4px ${t}`,setTimeout(()=>{e.style.boxShadow=o,setTimeout(()=>{e.style.transition=""},i)},i)}static canvasRipple(e,t,i,o=null){if(!e)return;o||(o=(window.themeManager?window.themeManager.getEffectiveTheme():"light")==="dark"?"rgba(255, 255, 255, 0.8)":"rgba(0, 0, 0, 0.8)");const s=document.createElement("div");if(s.style.position="absolute",s.style.left=`${t-10}px`,s.style.top=`${i-10}px`,s.style.width="20px",s.style.height="20px",s.style.borderRadius="50%",s.style.background=o,s.style.pointerEvents="none",s.style.animation="feedback-ripple 0.6s ease-out forwards",s.style.zIndex="1000",!document.getElementById("feedback-styles")){const r=document.createElement("style");r.id="feedback-styles",r.textContent=`
        @keyframes feedback-ripple {
          0% {
            transform: scale(0);
            opacity: 1;
          }
          100% {
            transform: scale(4);
            opacity: 0;
          }
        }
      `,document.head.appendChild(r)}const a=e.closest('[id*="container"]')||e.parentElement;a&&(a.style.position="relative",a.appendChild(s),setTimeout(()=>{s.parentElement&&s.parentElement.removeChild(s)},600))}}const v=new Ze;window.feedbackSystem={haptic:v,visual:b};class et{constructor(){this.themes=["light","dark","system"],this.currentTheme="system",this.init()}async init(){await this.loadThemePreference(),this.applyTheme(this.currentTheme),this.setupEventListeners(),this.setupSystemThemeListener(),this.updateThemeButtons(),await new Promise(e=>setTimeout(e,50)),this.initialized=!0,window.dispatchEvent(new CustomEvent("themeManagerReady"))}async loadThemePreference(){try{const e=await Ee();this.currentTheme=e.theme||"system"}catch{console.log("No stored theme preference, using system default"),this.currentTheme="system"}}async saveThemePreference(e){try{const t=await Ee();t.theme=e,await Ke(t)}catch(t){console.error("Failed to save theme preference:",t)}}setupEventListeners(){document.querySelectorAll("button[data-theme]").forEach(t=>{const i=t.dataset.theme;t.addEventListener("click",o=>{const s=o.currentTarget.dataset.theme;b.bounce(t,1.08,150),v.trigger("light"),this.setTheme(s),window.innerWidth<640&&this.showMobileTooltip(t,s)}),t.addEventListener("mouseenter",o=>{window.innerWidth>=640&&this.showThemeTooltip(o.currentTarget,i)}),t.addEventListener("mouseleave",()=>{window.innerWidth>=640&&this.hideTooltip()})})}setupSystemThemeListener(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{this.currentTheme==="system"&&this.applySystemTheme()})}async setTheme(e){this.themes.includes(e)&&(this.currentTheme=e,await this.saveThemePreference(e),this.applyTheme(e),this.updateThemeButtons())}applyTheme(e){const t=document.documentElement;t.classList.remove("dark","light"),e==="dark"?t.classList.add("dark"):e==="light"?t.classList.add("light"):e==="system"&&this.applySystemTheme(),this.updateMetaThemeColor(e),window.audioSystem&&window.audioSystem.updateThumbnailLoopStates&&window.audioSystem.updateThumbnailLoopStates()}applySystemTheme(){const e=document.documentElement,t=window.matchMedia("(prefers-color-scheme: dark)").matches;e.classList.remove("dark","light"),t?e.classList.add("dark"):e.classList.add("light"),window.audioSystem&&window.audioSystem.updateThumbnailLoopStates&&window.audioSystem.updateThumbnailLoopStates()}updateMetaThemeColor(e){const t=document.querySelector('meta[name="theme-color"]'),i=document.querySelector('meta[name="msapplication-TileColor"]');let o;e==="dark"||e==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches?o="#232323":o="#1F1F1F",t&&t.setAttribute("content",o),i&&i.setAttribute("content",o)}updateThemeButtons(){document.querySelectorAll("button[data-theme]").forEach(t=>{if(t.classList.remove("bg-swarmshadow-200","text-swarmlight-100","ring-2","ring-swarmlight-300","bg-swarmlight-300","text-swarmshadow-200","ring-swarmshadow-200","bg-swarmlight-200","text-black","text-white","font-semibold"),t.classList.remove("active"),t.dataset.theme===this.currentTheme){const i=t.dataset.theme,o=document.documentElement.classList.contains("dark");i==="dark"?t.classList.add("bg-swarmshadow-200","text-swarmlight-100"):i==="light"?t.classList.add("bg-swarmlight-300","text-swarmshadow-200"):i==="system"&&(t.classList.add("ring-2","font-semibold"),o?(t.classList.add("text-white","ring-swarmlight-600","dark:hover:text-swarmlight-50"),t.classList.remove("dark:hover:text-black")):t.classList.add("text-black","ring-swarmlight-300"),o?t.style.background="linear-gradient(45deg, #706A43 50%, #232323 50%)":t.style.background="linear-gradient(45deg, #FFFDE7 50%, #FFEE58 50%)"),i!=="system"&&(t.classList.add("ring-2"),o?t.classList.add("ring-swarmlight-600"):t.classList.add("ring-swarmlight-300"))}else t.dataset.theme==="system"&&(t.classList.add("dark:hover:text-black"),t.classList.remove("dark:hover:text-swarmlight-50"),t.style.background="")})}getCurrentTheme(){return this.currentTheme}getEffectiveTheme(){return this.currentTheme==="system"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":this.currentTheme}getThemeDescription(e){switch(e){case"light":return"Light theme - bright interface";case"dark":return"Dark theme - dark interface";case"system":return"System theme - follows your device settings";default:return"Theme option"}}showThemeTooltip(e,t){const i=this.getThemeDescription(t);if(window.showTooltip){const s=e.closest(".theme-switcher")||e;window.showTooltip(i,s,0)}}showMobileTooltip(e,t){const i=this.getThemeDescription(t);if(window.showTooltip){const s=e.closest(".theme-switcher")||e;window.showTooltip(i,s,0),setTimeout(()=>{window.hideTooltip&&window.hideTooltip()},2e3)}}hideTooltip(){window.hideTooltip&&window.hideTooltip()}}document.addEventListener("DOMContentLoaded",()=>{window.themeManager=new et});const X=5;class tt{constructor(){this.tutorialMode=!1,this.isActive=!1,this.currentStep=0,this.elements=this.initializeElements(),this.setupWelcomeModal(),setTimeout(()=>this.checkAndShowTutorial(),100)}initializeElements(){return{createBtn:document.getElementById("createSequenceBtn"),tutorialCounter:document.getElementById("tutorialCounter"),targetCountEl:document.getElementById("targetCount"),selectedCountEl:document.getElementById("selectedCount"),modalInstruction:document.getElementById("modalInstruction"),testBtn:document.getElementById("testSequenceBtn"),saveBtn:document.getElementById("saveSequenceBtn"),tutorialOverlay:document.getElementById("tutorialOverlay"),welcomeModal:document.getElementById("tutorialWelcomeModal"),beginBtn:document.getElementById("beginTutorialBtn"),beginBtnMobile:document.getElementById("beginTutorialBtnMobile"),welcomeSteps:document.getElementById("welcomeSteps"),welcomeStepsContainer:document.getElementById("welcomeStepsContainer"),dots:[document.getElementById("dot0"),document.getElementById("dot1"),document.getElementById("dot2")]}}setupWelcomeModal(){this.elements.beginBtn&&this.elements.beginBtn.addEventListener("click",()=>{this.handleBeginClick(this.elements.beginBtn)}),this.elements.beginBtnMobile&&this.elements.beginBtnMobile.addEventListener("click",()=>{this.handleBeginClick(this.elements.beginBtnMobile)}),this.setupMobileSwipe(),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.isWelcomeModalOpen()&&(this.closeWelcomeModal(),this.startMainTutorial())})}handleBeginClick(e){b.press(e,.95,150),v.trigger("medium"),this.closeWelcomeModal(),this.startMainTutorial()}setupMobileSwipe(){if(!this.elements.welcomeStepsContainer)return;let e=0,t=0,i=!1;const o=r=>{e=r.touches?r.touches[0].clientX:r.clientX,t=r.touches?r.touches[0].clientY:r.clientY,i=!0},s=r=>{i&&r.preventDefault()},a=r=>{if(!i)return;i=!1;const l=r.changedTouches?r.changedTouches[0].clientX:r.clientX,c=r.changedTouches?r.changedTouches[0].clientY:r.clientY,d=e-l,m=Math.abs(t-c);Math.abs(d)>50&&m<100&&(d>0?this.nextStep():this.previousStep())};this.elements.welcomeStepsContainer.addEventListener("touchstart",o,{passive:!1}),this.elements.welcomeStepsContainer.addEventListener("touchmove",s,{passive:!1}),this.elements.welcomeStepsContainer.addEventListener("touchend",a,{passive:!1}),this.elements.welcomeStepsContainer.addEventListener("mousedown",o),this.elements.welcomeStepsContainer.addEventListener("mousemove",s),this.elements.welcomeStepsContainer.addEventListener("mouseup",a)}nextStep(){this.currentStep<2&&(this.currentStep++,this.updateStepDisplay())}previousStep(){this.currentStep>0&&(this.currentStep--,this.updateStepDisplay())}updateStepDisplay(){if(this.elements.welcomeSteps){const e=-this.currentStep*100;this.elements.welcomeSteps.style.transform=`translateX(${e}%)`}this.elements.dots.forEach((e,t)=>{e&&(t===this.currentStep?(e.classList.remove("opacity-50"),e.classList.add("opacity-100")):(e.classList.remove("opacity-100"),e.classList.add("opacity-50")))})}async checkAndShowTutorial(){try{const e=await ye("tutorialSeen"),t=await K();!e&&t.length===0&&this.showWelcomeModal()}catch(e){console.log("Could not check tutorial state:",e)}}showWelcomeModal(){this.elements.welcomeModal&&(this.elements.welcomeModal.classList.remove("hidden"),this.elements.welcomeModal.classList.add("flex"),this.elements.welcomeModal.setAttribute("aria-hidden","false"),this.currentStep=0,this.updateStepDisplay(),setTimeout(()=>{const t=window.innerWidth<640?this.elements.beginBtnMobile:this.elements.beginBtn;t&&this.currentStep===2&&t.focus()},100))}closeWelcomeModal(){this.elements.welcomeModal&&(this.elements.welcomeModal.classList.add("hidden"),this.elements.welcomeModal.classList.remove("flex"),this.elements.welcomeModal.setAttribute("aria-hidden","true"),this.currentStep=0,this.updateStepDisplay())}isWelcomeModalOpen(){return this.elements.welcomeModal&&!this.elements.welcomeModal.classList.contains("hidden")}startMainTutorial(){this.isActive=!0,document.body.classList.add("tutorial-active"),this.elements.createBtn.classList.add("highlight-once"),window.showTooltip&&window.showTooltip("Start playing by clicking New Sequence!",this.elements.createBtn)}startTutorial(){this.showWelcomeModal()}enableTutorialMode(){this.tutorialMode=!0,this.elements.tutorialCounter&&(this.elements.tutorialCounter.classList.remove("hidden"),this.elements.targetCountEl.textContent=X,this.elements.selectedCountEl.textContent="0")}disableTutorialMode(){this.tutorialMode=!1,this.elements.tutorialCounter&&this.elements.tutorialCounter.classList.add("hidden")}updateTutorialUI(e){if(this.tutorialMode&&(this.elements.selectedCountEl&&(this.elements.selectedCountEl.textContent=e),this.elements.modalInstruction))if(e===0)this.elements.modalInstruction.textContent="Click the empty circles to form your sequence",this.elements.modalInstruction.classList.remove("hidden"),this.hideTooltip();else if(e<X){const t=X-e;this.elements.modalInstruction.textContent=`Select ${t} more circle${t===1?"":"s"}`,this.elements.modalInstruction.classList.remove("hidden"),this.hideTooltip()}else e===X&&(this.elements.modalInstruction.classList.add("hidden"),this.hideTooltip())}updateButtonStates(e){return this.tutorialMode?(e===X?this.elements.testBtn&&(this.elements.testBtn.disabled=!1,this.elements.testBtn.classList.add("highlight-once"),window.showTooltip&&window.showTooltip("Click Test to hear what your sequence sounds like!",this.elements.testBtn)):this.elements.testBtn&&(this.elements.testBtn.disabled=!0,this.elements.testBtn.classList.remove("highlight-once"),this.hideTooltip()),this.updateTutorialUI(e),!0):!1}async handleTestClick(){return this.tutorialMode?(this.hideTooltip(),this.elements.testBtn&&this.elements.testBtn.classList.remove("highlight-once"),this.elements.saveBtn&&(this.elements.saveBtn.disabled=!1),await this.completeTutorial(),!0):!1}async handleSaveClick(){return this.tutorialMode?(await this.completeTutorial(),!0):!1}async completeTutorial(){try{await fe("tutorialSeen",!0),this.tutorialMode=!1,this.isActive=!1,document.body.classList.remove("tutorial-active"),this.elements.createBtn&&this.elements.createBtn.classList.remove("highlight-once"),this.closeWelcomeModal()}catch(e){console.error("Error completing tutorial:",e)}}async resetTutorial(){try{return await fe("tutorialSeen",!1),this.tutorialMode=!1,this.isActive=!1,document.body.classList.remove("tutorial-active"),this.elements.createBtn&&this.elements.createBtn.classList.remove("highlight-once"),this.elements.tutorialCounter&&this.elements.tutorialCounter.classList.add("hidden"),this.elements.modalInstruction&&this.elements.modalInstruction.classList.add("hidden"),this.closeWelcomeModal(),console.log("âœ… Tutorial state reset"),!0}catch(e){return console.error("âŒ Error resetting tutorial:",e),!1}}cleanupTutorialState(){this.tutorialMode=!1,this.elements.tutorialCounter&&this.elements.tutorialCounter.classList.add("hidden"),this.elements.modalInstruction&&this.elements.modalInstruction.classList.add("hidden"),this.elements.testBtn&&this.elements.testBtn.classList.remove("highlight-once"),this.hideTooltip()}hideTooltip(){window.hideTooltip&&window.hideTooltip()}get isTutorialMode(){return this.tutorialMode}get isTutorialActive(){return this.isActive}get targetCount(){return X}}const x=new tt;window.tutorialManager=x;class Le{constructor(){this.sidenav=document.getElementById("sidenav"),this.toggleBtn=document.getElementById("sidenavToggle"),this.closeBtn=document.getElementById("sidenavClose"),this.infoBtn=document.getElementById("infoBtn"),this.resetTutorialBtn=document.getElementById("resetTutorialBtn"),this.appInfoModal=document.getElementById("appInfoModal"),this.closeAppInfoBtn=document.getElementById("closeAppInfoBtn"),this.isOpen=!1,this.init()}init(){this.setupEventListeners(),this.setupTooltips()}setupEventListeners(){this.toggleBtn.addEventListener("click",()=>{b.bounce(this.toggleBtn,1.1,120),v.trigger("light"),this.toggle()}),this.closeBtn.addEventListener("click",()=>{b.press(this.closeBtn,.9,100),v.trigger("light"),this.close()}),this.infoBtn.addEventListener("click",()=>{b.bounce(this.infoBtn,1.1,120),v.trigger("light"),this.openAppInfoModal()}),this.resetTutorialBtn.addEventListener("click",()=>{b.bounce(this.resetTutorialBtn,1.1,120),v.trigger("medium"),this.resetTutorial()}),this.closeAppInfoBtn.addEventListener("click",()=>{b.press(this.closeAppInfoBtn,.95,100),v.trigger("light"),this.closeAppInfoModal()}),this.appInfoModal.addEventListener("click",e=>{e.target===this.appInfoModal&&this.closeAppInfoModal()}),document.addEventListener("click",e=>{this.isOpen&&!this.sidenav.contains(e.target)&&!this.toggleBtn.contains(e.target)&&this.close()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&(this.appInfoModal&&!this.appInfoModal.classList.contains("hidden")?this.closeAppInfoModal():this.isOpen&&this.close())})}setupTooltips(){this.infoBtn.addEventListener("mouseenter",()=>{window.showTooltip&&window.innerWidth>=640&&window.showTooltip("App information",this.infoBtn)}),this.infoBtn.addEventListener("mouseleave",()=>{window.hideTooltip&&window.innerWidth>=640&&window.hideTooltip()}),this.resetTutorialBtn.addEventListener("mouseenter",()=>{window.showTooltip&&window.innerWidth>=640&&window.showTooltip("Reset tutorial",this.resetTutorialBtn)}),this.resetTutorialBtn.addEventListener("mouseleave",()=>{window.hideTooltip&&window.innerWidth>=640&&window.hideTooltip()}),this.toggleBtn.addEventListener("mouseenter",()=>{if(window.showTooltip&&window.innerWidth>=640){const e=this.isOpen?"Close side panel":"Open side panel";window.showTooltip(e,this.toggleBtn)}}),this.toggleBtn.addEventListener("mouseleave",()=>{window.hideTooltip&&window.innerWidth>=640&&window.hideTooltip()}),this.closeBtn.addEventListener("mouseenter",()=>{window.showTooltip&&window.innerWidth>=640&&window.showTooltip("Close side panel",this.closeBtn)}),this.closeBtn.addEventListener("mouseleave",()=>{window.hideTooltip&&window.innerWidth>=640&&window.hideTooltip()})}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen=!0,this.sidenav.classList.remove("translate-x-full"),this.sidenav.classList.add("translate-x-0"),this.updateToggleButton()}close(){this.isOpen=!1,this.sidenav.classList.remove("translate-x-0"),this.sidenav.classList.add("translate-x-full"),this.updateToggleButton(),window.hideTooltip&&window.hideTooltip()}updateToggleButton(){const e=this.toggleBtn.querySelector("svg path");this.isOpen?(e.setAttribute("d","M15 19l-7-7 7-7"),this.toggleBtn.setAttribute("title","Close side panel"),this.toggleBtn.setAttribute("aria-label","Close side panel")):(e.setAttribute("d","M9 5l7 7-7 7"),this.toggleBtn.setAttribute("title","Open side panel"),this.toggleBtn.setAttribute("aria-label","Open side panel"))}async resetTutorial(){try{if(await x.resetTutorial())window.showTooltip&&(window.showTooltip("Tutorial reset! Reload page to see tutorial.",this.resetTutorialBtn),setTimeout(()=>{window.hideTooltip&&window.hideTooltip()},3e3)),setTimeout(()=>{confirm("Tutorial has been reset! Would you like to reload the page to see the tutorial?")&&window.location.reload()},500);else throw new Error("Failed to reset tutorial")}catch(e){console.error("Error resetting tutorial:",e),window.showTooltip&&(window.showTooltip("Error resetting tutorial. Please try again.",this.resetTutorialBtn),setTimeout(()=>{window.hideTooltip&&window.hideTooltip()},3e3))}}openAppInfoModal(){this.appInfoModal&&(this.appInfoModal.classList.remove("hidden"),this.appInfoModal.classList.add("flex"),this.appInfoModal.setAttribute("aria-hidden","false"),this.close(),setTimeout(()=>{this.closeAppInfoBtn.focus()},100))}closeAppInfoModal(){this.appInfoModal&&(this.appInfoModal.classList.add("hidden"),this.appInfoModal.classList.remove("flex"),this.appInfoModal.setAttribute("aria-hidden","true"),this.infoBtn.focus())}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.sidenavManager=new Le}):window.sidenavManager=new Le;const w=document.getElementById("soundCanvas"),f=w.getContext("2d"),A=window.devicePixelRatio||1;let S=-1,O=new Map;const _=new Audio("./assets/5.mp3"),Y=[{dirX:0,dirY:-1,audio:new Audio("./assets/2.mp3")},{dirX:0,dirY:1,audio:new Audio("./assets/8.mp3")},{dirX:-1,dirY:0,audio:new Audio("./assets/4.mp3")},{dirX:1,dirY:0,audio:new Audio("./assets/6.mp3")},{dirX:1/Math.SQRT2,dirY:-1/Math.SQRT2,audio:new Audio("./assets/3.mp3")},{dirX:-1/Math.SQRT2,dirY:-1/Math.SQRT2,audio:new Audio("./assets/1.mp3")},{dirX:-1/Math.SQRT2,dirY:1/Math.SQRT2,audio:new Audio("./assets/7.mp3")},{dirX:1/Math.SQRT2,dirY:1/Math.SQRT2,audio:new Audio("./assets/9.mp3")}];function nt(){const n=w.clientWidth,e=w.clientHeight;w.width=n*A,w.height=e*A,f.resetTransform(),f.scale(A,A)}function z(){nt();const n=w.clientWidth,e=w.clientHeight,t=n/2,i=e/2,o=Math.min(n,e),s=.4,a=o*.15*s,r=a*.4,l=a+r+o*.12*s;if(f.clearRect(0,0,n,e),f.beginPath(),f.arc(t,i,a,0,Math.PI*2),f.lineWidth=r,O.has(-1)){const{startTime:d,duration:m}=O.get(-1),h=ke(d,m);if(h>0){const g=Math.floor(255*h),p=Math.floor(107*h),M=Math.floor(107*h);f.strokeStyle=`rgb(${g}, ${p}, ${M})`}else{const g=window.themeManager?window.themeManager.getEffectiveTheme():"light";f.strokeStyle=g==="dark"?"#fff":"#000",O.delete(-1)}}else{const d=window.themeManager?window.themeManager.getEffectiveTheme():"light";f.strokeStyle=d==="dark"?"#fff":"#000"}if(f.stroke(),S===-1){f.beginPath(),f.arc(t,i,a+r/2+4,0,Math.PI*2);const d=window.themeManager?window.themeManager.getEffectiveTheme():"light";f.strokeStyle=d==="dark"?"#FFF176":"#F57F17",f.lineWidth=3,f.setLineDash([5,5]),f.stroke(),f.setLineDash([])}[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0},{x:1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:1/Math.SQRT2},{x:1/Math.SQRT2,y:1/Math.SQRT2}].forEach((d,m)=>{for(let h=1;h<=3;h++){const g=t+d.x*l*h,p=i+d.y*l*h,M=m*3+(h-1);if(f.beginPath(),f.arc(g,p,r,0,Math.PI*2),O.has(M)){const{startTime:y,duration:L}=O.get(M),C=ke(y,L);if(C>0){const E=Math.floor(255*C),H=Math.floor(107*C),P=Math.floor(107*C);f.fillStyle=`rgb(${E}, ${H}, ${P})`,f.fill(),f.strokeStyle="#fff",f.lineWidth=2,f.stroke()}else{O.delete(M);const E=window.themeManager?window.themeManager.getEffectiveTheme():"light";f.fillStyle=E==="dark"?"#fff":"#000",f.fill()}}else{const y=window.themeManager?window.themeManager.getEffectiveTheme():"light";f.fillStyle=y==="dark"?"#fff":"#000",f.fill()}if(S===M){f.beginPath(),f.arc(g,p,r+4,0,Math.PI*2);const y=window.themeManager?window.themeManager.getEffectiveTheme():"light";f.strokeStyle=y==="dark"?"#FFF176":"#F57F17",f.lineWidth=3,f.setLineDash([3,3]),f.stroke(),f.setLineDash([])}}})}let Z=[];const it=.006,ot=.016;w.addEventListener("click",n=>{const e=w.getBoundingClientRect(),t=w.clientWidth,i=w.clientHeight,o=n.clientX-e.left,s=n.clientY-e.top,a=t/2,r=i/2,l=Math.min(t,i),c=.4,d=l*.15*c;if((o-a)**2+(s-r)**2<=d*d){b.canvasRipple(w,o,s),v.trigger("medium"),Z.push({x:a,y:r,radius:d,alpha:1}),_.currentTime=0,_.play();return}const m=d*.4,h=d+m+l*.12*c;for(const{dirX:g,dirY:p,audio:M}of Y)for(let y=1;y<=3;y++){const L=a+g*h*y,C=r+p*h*y;if((o-L)**2+(s-C)**2<=m*m){b.canvasRipple(w,o,s),v.trigger("light"),M.currentTime=0,M.play();return}}});w.addEventListener("keydown",n=>{switch(document.getElementById("canvas-announcements"),n.key){case"ArrowUp":n.preventDefault(),S=Math.max(-1,S-8),V(),z();break;case"ArrowDown":n.preventDefault(),S=Math.min(23,S+8),V(),z();break;case"ArrowLeft":n.preventDefault(),S===-1?S=21:S=(S-1+24)%24,V(),z();break;case"ArrowRight":n.preventDefault(),S===-1?S=0:S=(S+1)%24,V(),z();break;case" ":case"Enter":n.preventDefault(),st();break;case"Home":n.preventDefault(),S=-1,V(),z();break}});function V(){const n=document.getElementById("canvas-announcements");if(n)if(S===-1)n.textContent="Center circle selected. Press space or enter to play center sound.";else{const e=["top","bottom","left","right","top-right","top-left","bottom-left","bottom-right"][S%8],t=Math.floor(S/8)+1;n.textContent=`${e} circle, ring ${t} selected. Press space or enter to play sound.`}}function st(){if(S===-1){Math.min(w.clientWidth,w.clientHeight);const n=w.clientWidth/2,e=w.clientHeight/2;b.canvasRipple(w,n,e),v.trigger("medium"),_.currentTime=0,_.play();const t=document.getElementById("canvas-announcements");t&&(t.textContent="Center circle activated. Water drop sound played.")}else{const n=S%8,t=[0,1,2,3,4,5,7,6][n],{audio:i,dirX:o,dirY:s}=Y[t],a=Math.min(w.clientWidth,w.clientHeight),r=.4,l=a*.15*r,c=l*.4,d=l+c+a*.12*r,m=Math.floor(S/8)+1,h=w.clientWidth/2,g=w.clientHeight/2,p=h+o*d*m,M=g+s*d*m;b.canvasRipple(w,p,M),v.trigger("light"),i.currentTime=0,i.play();const y=document.getElementById("canvas-announcements");if(y){const L=["top","bottom","left","right","top-right","top-left","bottom-left","bottom-right"][n];y.textContent=`${L} circle activated. Clicking sound played.`}}}function at(){const e=Math.min(w.clientWidth,w.clientHeight)*it,i=(window.themeManager?window.themeManager.getEffectiveTheme():"light")==="dark"?"255,255,255":"0,0,0";Z.forEach((o,s)=>{f.beginPath(),f.arc(o.x,o.y,o.radius,0,Math.PI*2),f.strokeStyle=`rgba(${i},${o.alpha})`,f.lineWidth=2,f.stroke(),o.radius+=e,o.alpha-=ot,o.alpha<=0&&Z.splice(s,1)})}function Re(){z(),at(),requestAnimationFrame(Re)}function rt(n,e=500){const t=Date.now();O.set(n,{startTime:t,duration:e})}function lt(){O.clear()}window.canvasHighlight={highlightCircle:rt,clearAllHighlights:lt};function ke(n,e){const t=Date.now()-n,i=Math.min(t/e,1),o=4,s=Math.max(0,1-i),a=Math.sin(t*o/100)*.3+.7;return s*a}Re();const ge={ZERO:0,ONE:.25,TWO:.5,THREE:.75},ct=.01;let he=null;function De(){return he||(he=new(window.AudioContext||window.webkitAudioContext)),he}function Pe(n){const e=Math.floor(n/3),t=n%3;return{radian:t+1,direction:e,position:t}}function dt(n){const e=Math.floor(n/3);return Y[e]?Y[e].audio:null}function ht(){if(Z&&w){const n=w.clientWidth/2,e=w.clientHeight/2,o=Math.min(w.clientWidth,w.clientHeight)*.15*.4;Z.push({x:n,y:e,radius:o,alpha:1})}}async function ie(n,e={}){if(!n||n.length===0){console.warn("No sequence to play");return}const{inModal:t=!1}=e,i=De();i.state==="suspended"&&await i.resume(),window.canvasHighlight&&window.canvasHighlight.clearAllHighlights(),t&&window.modalHighlight&&window.modalHighlight.clearModalHighlights();const o={0:[],1:[],2:[],3:[]};n.forEach(s=>{const{radian:a}=Pe(s);o[a].push(s)}),ht(),t&&window.modalHighlight&&window.modalHighlight.createModalRipple(),_&&setTimeout(()=>{_.currentTime=0,_.play().catch(s=>console.warn("Failed to play droplet sound:",s)),window.canvasHighlight&&window.canvasHighlight.highlightCircle(-1,400),t&&window.modalHighlight&&window.modalHighlight.highlightModalCircle(-1,400)},0),Object.keys(o).forEach(s=>{const a=o[s];if(a.length===0)return;const r=parseInt(s),l=ge[Object.keys(ge)[r]]*1e3;a.forEach((c,d)=>{const m=dt(c);if(m){const h=l+d*ct*1e3;setTimeout(()=>{m.currentTime=0,m.play().catch(g=>console.warn(`Failed to play audio for circle ${c}:`,g)),v.radianFeedback(r),window.canvasHighlight&&window.canvasHighlight.highlightCircle(c,600),t&&window.modalHighlight&&window.modalHighlight.highlightModalCircle(c,600)},h)}})})}const oe=5;let $=new Map;function We(n,e){return n||JSON.stringify(e)}function Me(n,e,t=null){const i=We(t,n);if($.has(i)){const o=$.get(i);clearInterval(o.timer),$.delete(i),console.log("ðŸ”„ Loop playback stopped for thumbnail"),we(),ee()}else{if($.size>=oe){console.warn(`ðŸ”„ Maximum number of concurrent loops (${oe}) reached. Cannot start new loop.`);const s=document.getElementById("loopCounter");if(s){const a=s.className;s.className=s.className.replace(/bg-\S+/g,"bg-red-200 dark:bg-red-800"),s.style.animation="pulse 0.5s ease-in-out 2",setTimeout(()=>{s.className=a,s.style.animation=""},1e3)}return}console.log(`ðŸ”„ Starting loop playback every ${e}s`),ie(n);const o=setInterval(async()=>{try{await ie(n)}catch(s){console.error("Error in loop playback:",s),Me(n,e,t)}},e*1e3);$.set(i,{timer:o,sequence:n,interval:e,thumbnail:t}),console.log("ðŸ”„ Loop playback started"),we(),ee()}}function He(n,e=null){if(!n)return!1;const t=We(e,n);return $.has(t)}function ee(){const n=document.getElementById("loopCounter");if(!n)return;const e=$.size;e>0?(n.textContent=`Loops playing: ${e}/${oe}`,n.classList.remove("hidden")):n.classList.add("hidden")}function we(){const n=document.getElementById("sequenceBar");if(!n)return;n.querySelectorAll("canvas").forEach(t=>{const i=t.sequenceData;if(i){const o=He(i.seq,t),s=document.documentElement.classList.contains("dark");t.classList.remove("bg-swarmstripe-200/50","bg-swarmshadow-50","rounded-lg","transition-colors","duration-300","ease-in-out","loop-pulse-animation","p-2"),t.style.backgroundColor="",t.style.animation="",o&&(t.classList.add("rounded-full","transition-colors","duration-300","ease-in-out","loop-pulse-animation","p-2"),s?t.classList.add("bg-swarmshadow-50"):t.classList.add("bg-swarmstripe-200/50"),t.style.animation="loop-pulse 2s ease-in-out infinite")}})}function pe(){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",pe);return}const n=document.getElementById("sequenceBar");if(!n){console.warn("Sequence bar not found, retrying..."),setTimeout(pe,100);return}n.addEventListener("click",async e=>{const t=e.target.closest("canvas");if(!t)return;b.bounce(t,1.1,120),v.trigger("light");let i;if(t.sequenceData)i=t.sequenceData;else{const r=Array.from(n.children).indexOf(t);try{i=(await K())[r]}catch(l){console.error("Error loading sequence:",l);return}}if(!i)return;let o,s,a;Array.isArray(i)?(o=i,s=!1,a=3):(o=i.seq||i.sequence,s=i.isLoop||!1,a=i.loopInterval||3);try{s?Me(o,a,t):await ie(o)}catch(r){console.error("Error playing sequence:",r)}})}pe();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ee):ee();window.audioSystem={playSequence:ie,initAudioContext:De,toggleLoopPlayback:Me,isSequenceLooping:He,updateThumbnailLoopStates:we,updateLoopCounter:ee,getRadianInfo:Pe,RADIAN_TIMING:ge,MAX_CONCURRENT_LOOPS:oe,getActiveLoopCount:()=>$.size};const q=document.getElementById("tooltip");function Fe(n,e,t=0){const i=e.getBoundingClientRect(),o=window.innerWidth,s=window.innerHeight;q.textContent=n;const a=e.closest("#sequenceModal")!==null,r=window.__TAURI__!==void 0;let l,c;if(a||o<640){const d=q.offsetWidth||200;if(a){const h=document.getElementById("modalContent").getBoundingClientRect();l=h.left+(h.width-d)/2,c=h.top-40,c<16&&(c=h.top+8)}else l=(o-d)/2,c=i.bottom+8;l=Math.max(8,Math.min(l,o-d-8)),c=Math.max(8,Math.min(c,s-50))}else if(l=i.left+i.width/2-q.offsetWidth/2+t,c=i.bottom+16,r){const d=q.offsetWidth||200,m=q.offsetHeight||40;l=Math.max(16,Math.min(l,o-d-16)),c=Math.max(16,Math.min(c,s-m-16));const h=i.left+i.width/2;Math.abs(l+d/2-h)>100&&(l=h-d/2,l=Math.max(16,Math.min(l,o-d-16)))}else{const d=q.offsetWidth||200;l=Math.max(8,Math.min(l,o-d-8))}q.style.left=l+"px",q.style.top=c+"px",q.classList.remove("hidden"),q.removeAttribute("aria-hidden")}function re(){q.classList.add("hidden"),q.setAttribute("aria-hidden","true")}window.showTooltip=Fe;window.hideTooltip=re;window.showTooltip=Fe;window.hideTooltip=re;function ue(){if(window.themeManager){const n=window.themeManager.getEffectiveTheme(),e=document.documentElement.classList.contains("dark");if(n==="dark"&&e||n==="light"&&!e)return n}return document.documentElement.classList.contains("dark")?"dark":document.documentElement.classList.contains("light")?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}async function se(n){var L;const e=document.getElementById("sequenceBar"),t=80,i=document.createElement("canvas");i.width=t*A,i.height=t*A,i.style.width=t+"px",i.style.height=t+"px";const o=i.getContext("2d");o.scale(A,A);let s,a,r;Array.isArray(n)?(s=n,a=!1,r=3):(s=n.sequence||n,a=n.isLoop||!1,r=n.loopInterval||3);const l=3,c=t-l,d=t/2,m=t/2,h=c*.08,g=h*.35,p=h*1.8;o.beginPath(),o.arc(d,m,h,0,2*Math.PI);const M=ue(),y=M==="dark"?"#fff":"#000";if(window.location.hostname==="localhost"&&console.log("Thumbnail generation - Effective theme:",M,"Center color:",y,"DOM dark class:",document.documentElement.classList.contains("dark"),"Theme manager available:",!!window.themeManager,"Theme manager theme:",(L=window.themeManager)==null?void 0:L.getEffectiveTheme()),o.fillStyle=y,o.fill(),Y.forEach(({dirX:C,dirY:E,audio:H},P)=>{for(let W=1;W<=3;W++){const $e=[0,1,2,3,4,5,7,6].indexOf(P)*3+(W-1),Qe=s.includes($e),ce=d+C*p*W,de=m+E*p*W;if(ce-g>=l&&ce+g<=t-l&&de-g>=l&&de+g<=t-l){o.beginPath(),o.arc(ce,de,g,0,2*Math.PI);const Se=ue(),_e=Se==="dark"?"#fff":"#000",Ne=Se==="dark"?"#000":"#fff";o.fillStyle=_e,o.strokeStyle=Ne,o.lineWidth=.5,Qe?o.fill():o.stroke()}}}),i.sequenceData={seq:s,isLoop:a,loopInterval:r},window.audioSystem&&window.audioSystem.isSequenceLooping&&window.audioSystem.isSequenceLooping(s,i)){const E=ue()==="dark";i.classList.add("rounded-full","transition-colors","duration-300","ease-in-out","p-2"),E?i.classList.add("bg-swarmshadow-50"):i.classList.add("bg-swarmstripe-200/50"),i.style.animation="loop-pulse 2s ease-in-out infinite"}e.appendChild(i)}function ut(){K().then(n=>{n.forEach(e=>se(e)),console.log(`âœ… Loaded ${n.length} saved sequences`)}).catch(n=>{console.error("Failed to load sequences:",n)})}function Ce(){document.getElementById("sequenceBar").querySelectorAll("canvas").forEach(t=>t.remove()),K().then(t=>{t.forEach(i=>se(i))}).catch(t=>{console.error("Failed to reload sequences after theme change:",t)})}function mt(){if(window.themeManager&&window.themeManager.initialized){const n=window.themeManager.setTheme.bind(window.themeManager);window.themeManager.setTheme=async function(e){await n(e),Ce()}}else window.addEventListener("themeManagerReady",()=>{const n=window.themeManager.setTheme.bind(window.themeManager);window.themeManager.setTheme=async function(e){await n(e),Ce()}},{once:!0})}document.addEventListener("DOMContentLoaded",mt);function xe(){function n(){if(window.themeManager&&window.themeManager.initialized){const e=window.themeManager.getEffectiveTheme(),t=document.documentElement.classList.contains("dark"),i=document.documentElement.classList.contains("light");e==="dark"&&t||e==="light"&&(i||!t&&!i)?ut():requestAnimationFrame(n)}else window.addEventListener("themeManagerReady",()=>{requestAnimationFrame(n)},{once:!0})}n()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",xe):xe();class ft{constructor(){this.contextMenu=null,this.currentThumbnail=null,this.init()}init(){this.contextMenu=document.getElementById("contextMenu"),this.setupEventListeners()}setupEventListeners(){document.addEventListener("click",t=>{this.contextMenu.contains(t.target)||this.hideContextMenu()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&this.hideContextMenu()}),document.getElementById("editSequence").addEventListener("click",()=>{b.press(document.getElementById("editSequence"),.95,100),v.trigger("light"),this.editSequence(),this.hideContextMenu()}),document.getElementById("deleteSequence").addEventListener("click",()=>{b.press(document.getElementById("deleteSequence"),.95,100),v.trigger("medium"),this.deleteSequence(),this.hideContextMenu()});const e=document.getElementById("sequenceBar");e&&e.addEventListener("contextmenu",t=>{const i=t.target.closest("canvas");i&&i.sequenceData&&(t.preventDefault(),this.showContextMenu(t,i))})}showContextMenu(e,t){this.currentThumbnail=t,this.contextMenu.style.visibility="hidden",this.contextMenu.classList.remove("hidden");const i=this.contextMenu.getBoundingClientRect(),o=i.width,s=i.height,a=window.innerWidth,r=window.innerHeight;let l=e.clientX,c=e.clientY;const d=8;l+o+d>a&&(l=l-o,l<d&&(l=a-o-d)),l=Math.max(d,l),c+s+d>r&&(c=c-s,c<d&&(c=r-s-d)),c=Math.max(d,c);const m=document.getElementById("sequenceBar");if(m){const h=m.getBoundingClientRect();e.clientY>=h.top&&c+s>h.top&&(c=Math.max(d,h.top-s-4))}this.contextMenu.style.left=l+"px",this.contextMenu.style.top=c+"px",this.contextMenu.style.visibility="visible"}hideContextMenu(){this.contextMenu.classList.add("hidden"),this.contextMenu.style.visibility="",this.currentThumbnail=null}editSequence(){if(!this.currentThumbnail||!this.currentThumbnail.sequenceData)return;const e=this.currentThumbnail.sequenceData;this.currentThumbnail.setAttribute("data-editing","true"),window.modalManager&&window.modalManager.openEditMode(e,this.currentThumbnail)}async deleteSequence(){if(!this.currentThumbnail||!this.currentThumbnail.sequenceData)return;const e=this.currentThumbnail,t=this.currentThumbnail.sequenceData;if(confirm("Are you sure you want to delete this sequence? This action cannot be undone."))try{const s=(await K()).findIndex(a=>{const r=Array.isArray(a)?a:a.sequence||a.seq,l=Array.isArray(t)?t:t.sequence||t.seq;return JSON.stringify(r)===JSON.stringify(l)});if(s!==-1){if(await Ge(s),e.remove(),window.audioSystem&&window.audioSystem.isSequenceLooping){const a=Array.isArray(t)?t:t.sequence||t.seq;if(window.audioSystem.isSequenceLooping(a,e)){const r=t.loopInterval||3;window.audioSystem.toggleLoopPlayback(a,r,e)}}console.log("âœ… Sequence deleted successfully")}else console.error("âŒ Sequence not found in storage"),alert("Sequence not found in storage. It may have already been deleted.")}catch(o){console.error("âŒ Failed to delete sequence:",o),alert("Failed to delete sequence. Please try again.")}}}document.addEventListener("DOMContentLoaded",()=>{window.contextMenuManager=new ft});const me=document.getElementById("createSequenceBtn"),D=document.getElementById("sequenceModal"),k=document.getElementById("sequenceCanvas"),u=k.getContext("2d"),Be=document.getElementById("modalTitle");let F=new Map,te=[];const gt=4,wt=.04;class Oe{constructor(){this.isEditMode=!1,this.editingThumbnail=null,this.originalSequenceData=null,this.init()}init(){this.setupEventListeners()}setupEventListeners(){me.addEventListener("click",()=>{b.bounce(me,1.05,150),v.trigger("medium"),this.openCreateMode()})}async openCreateMode(){re(),me.classList.remove("highlight-once"),document.body.classList.remove("tutorial-active"),this.isEditMode=!1,this.editingThumbnail=null,this.originalSequenceData=null,Be.textContent="Create New Sequence",await ye("tutorialSeen")?x.disableTutorialMode():x.enableTutorialMode(),this.resetModalState(),this.showModal()}openEditMode(e,t){this.isEditMode=!0,this.editingThumbnail=t,this.originalSequenceData=JSON.parse(JSON.stringify(e)),Be.textContent="Edit Sequence",x.disableTutorialMode(),this.resetModalState(),this.showModal(),this.loadSequenceIntoModal(e),R(),ae()}resetModalState(){I.forEach(e=>{e.clicked=!1}),j.checked=!1,Q.value=3,ne.style.opacity="0.5",Q.disabled=!0,F.clear(),te.length=0,x.cleanupTutorialState()}loadSequenceIntoModal(e){const t=Array.isArray(e)?e:e.seq||e.sequence||[],i=e.isLoop||!1,o=e.loopInterval||3;j.checked=i,Q.value=o,i&&(ne.style.opacity="1",Q.disabled=!1),t.forEach(s=>{I[s]&&(I[s].clicked=!0)})}showModal(){D.classList.remove("hidden"),D.classList.add("flex"),D.setAttribute("aria-hidden","false"),T=-1,this.initializeModalCircles(),R(),Te(),x.isTutorialMode&&x.updateTutorialUI(0),ae(),setTimeout(()=>{k.focus()},100)}initializeModalCircles(){const e=k.clientWidth,t=k.clientHeight,i=250,o=(e-i)/2,s=(t-i)/2,a=i/2,r=i/2,l=i*.09,c=l*.3,d=l+c*2,m=[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0},{x:1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:1/Math.SQRT2},{x:1/Math.SQRT2,y:1/Math.SQRT2}];I=[],m.forEach((h,g)=>{const M=Y[[0,1,2,3,4,5,7,6][g]].audio;for(let y=1;y<=3;y++)I.push({x:o+a+h.x*d*y,y:s+r+h.y*d*y,r:c,audio:M,clicked:!1})})}}function pt(){const n=k.clientWidth,e=k.clientHeight;k.width=n*A,k.height=e*A,u.resetTransform(),u.scale(A,A)}const U=document.getElementById("testSequenceBtn"),N=document.getElementById("saveSequenceBtn"),j=document.getElementById("loopToggle"),Q=document.getElementById("loopInterval"),ne=document.getElementById("loopIntervalControls");let I=[],T=-1;const yt=new Oe;window.modalManager=yt;function R(){pt();const n=k.clientWidth,e=k.clientHeight,t=Math.min(250,250);u.clearRect(0,0,n,e),u.save();const i=(n-t)/2,o=(e-t)/2;u.translate(i,o);const s=t/2,a=t/2;Mt();const r=t*.09;if(u.beginPath(),u.arc(s,a,r,0,2*Math.PI),F.has(-1)){const{startTime:m,duration:h}=F.get(-1),g=qe(m,h);if(g>0){const p=Math.floor(255*g),M=Math.floor(107*g),y=Math.floor(107*g);u.fillStyle=`rgb(${p}, ${M}, ${y})`}else{const p=window.themeManager?window.themeManager.getEffectiveTheme():"light";u.fillStyle=p==="dark"?"#fff":"#000",F.delete(-1)}}else{const m=window.themeManager?window.themeManager.getEffectiveTheme():"light";u.fillStyle=m==="dark"?"#fff":"#000"}if(u.fill(),T===-1){u.beginPath(),u.arc(s,a,r+4,0,Math.PI*2);const m=window.themeManager?window.themeManager.getEffectiveTheme():"light";u.strokeStyle=m==="dark"?"#FFF176":"#F57F17",u.lineWidth=3,u.setLineDash([3,3]),u.stroke(),u.setLineDash([])}const l=r*.3,c=r+l*2;[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0},{x:1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:1/Math.SQRT2},{x:1/Math.SQRT2,y:1/Math.SQRT2}].forEach((m,h)=>{var g;for(let p=1;p<=3;p++){const M=s+m.x*c*p,y=a+m.y*c*p,L=h*3+(p-1);u.beginPath(),u.arc(M,y,l,0,2*Math.PI);const C=(g=I[L])==null?void 0:g.clicked;if(F.has(L)){const{startTime:E,duration:H}=F.get(L),P=qe(E,H);if(P>0){const W=Math.floor(255*P),B=Math.floor(107*P),ve=Math.floor(107*P);u.fillStyle=`rgb(${W}, ${B}, ${ve})`,u.fill(),u.strokeStyle="#fff",u.lineWidth=2,u.stroke()}else{F.delete(L);const B=(window.themeManager?window.themeManager.getEffectiveTheme():"light")==="dark"?"#fff":"#000";C?(u.fillStyle=B,u.fill()):(u.strokeStyle=B,u.lineWidth=2,u.stroke())}}else{const H=(window.themeManager?window.themeManager.getEffectiveTheme():"light")==="dark"?"#fff":"#000";C?(u.fillStyle=H,u.fill()):(u.strokeStyle=H,u.lineWidth=2,u.stroke())}if(T===L){u.beginPath(),u.arc(M,y,l+3,0,Math.PI*2);const E=window.themeManager?window.themeManager.getEffectiveTheme():"light";u.strokeStyle=E==="dark"?"#FFF176":"#F57F17",u.lineWidth=2,u.setLineDash([2,2]),u.stroke(),u.setLineDash([])}}}),u.restore()}function Mt(n,e,t,i){const s=(window.themeManager?window.themeManager.getEffectiveTheme():"light")==="dark"?"255,255,255":"0,0,0";te.forEach((a,r)=>{u.beginPath(),u.arc(a.x,a.y,a.radius,0,Math.PI*2),u.strokeStyle=`rgba(${s},${a.alpha})`,u.lineWidth=2,u.stroke(),a.radius+=gt,a.alpha-=wt,a.alpha<=0&&te.splice(r,1)})}function Tt(n,e=600){const t=Date.now();F.set(n,{startTime:t,duration:e})}function vt(){F.clear()}function St(){te.push({x:125,y:125,radius:22.5,alpha:1})}function Te(){D.classList.contains("hidden")||(R(),requestAnimationFrame(Te))}window.modalHighlight={highlightModalCircle:Tt,clearModalHighlights:vt,createModalRipple:St,startAnimation:Te};k.addEventListener("click",async n=>{const e=k.getBoundingClientRect(),t=n.clientX-e.left,i=n.clientY-e.top,o=k.clientWidth,s=k.clientHeight,a=250,r=(o-a)/2,l=(s-a)/2,c=t-r,d=i-l,m=a/2,h=a/2,g=a*.09,p=g*.3,M=g+p*2;[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0},{x:1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:1/Math.SQRT2},{x:1/Math.SQRT2,y:1/Math.SQRT2}].forEach((L,C)=>{for(let E=1;E<=3;E++){const H=m+L.x*M*E,P=h+L.y*M*E,W=C*3+(E-1),B=I[W];if(B&&(c-H)**2+(d-P)**2<=p*p){B.clicked=!B.clicked,b.canvasRipple(k,t,i),v.trigger(B.clicked?"medium":"light"),B.clicked&&(B.audio.currentTime=0,B.audio.play()),ae(),R();return}}})});k.addEventListener("keydown",n=>{if(!D.classList.contains("hidden"))switch(n.key){case"ArrowUp":n.preventDefault(),T=Math.max(-1,T-8),G(),R();break;case"ArrowDown":n.preventDefault(),T=Math.min(23,T+8),G(),R();break;case"ArrowLeft":n.preventDefault(),T===-1?T=21:T=(T-1+24)%24,G(),R();break;case"ArrowRight":n.preventDefault(),T===-1?T=0:T=(T+1)%24,G(),R();break;case" ":case"Enter":n.preventDefault(),bt();break;case"Home":n.preventDefault(),T=-1,G(),R();break}});function G(){const n=document.getElementById("canvas-announcements");if(n)if(T===-1)n.textContent="Center circle selected in sequence editor. Press space or enter to select/deselect.";else{const e=["top","bottom","left","right","top-right","top-left","bottom-left","bottom-right"][T%8],t=Math.floor(T/8)+1,i=I[T],o=i!=null&&i.clicked?"selected":"unselected";n.textContent=`${e} circle, ring ${t} - currently ${o}. Press space or enter to toggle.`}}function bt(){if(T===-1){const n=document.getElementById("canvas-announcements");n&&(n.textContent="Center circle cannot be selected in sequence editor.")}else{const n=I[T];if(n){n.clicked=!n.clicked,v.trigger(n.clicked?"medium":"light"),n.clicked&&(n.audio.currentTime=0,n.audio.play()),ae(),R();const e=document.getElementById("canvas-announcements");if(e){const t=["top","bottom","left","right","top-right","top-left","bottom-left","bottom-right"][T%8],i=Math.floor(T/8)+1,o=n.clicked?"selected":"deselected";e.textContent=`${t} circle, ring ${i} ${o}.`}}}}function ae(){const n=I.filter(e=>e.clicked).length;x.updateButtonStates(n)||(n>0?(U.disabled=!1,N.disabled=!1):(U.disabled=!0,N.disabled=!0))}U.addEventListener("click",async n=>{b.press(U,.95,100),v.trigger("medium"),await x.handleTestClick();const e=I.map((t,i)=>t.clicked?i:null).filter(t=>t!==null);if(e.length>0)try{window.audioSystem&&window.audioSystem.playSequence?await window.audioSystem.playSequence(e,{inModal:!0}):console.warn("Audio system not available, falling back to basic feedback"),x.isTutorialMode||(N.disabled=!1)}catch(t){console.error("Error playing test sequence:",t),x.isTutorialMode||(N.disabled=!1)}});j.addEventListener("change",()=>{const n=j.checked;Q.disabled=!n,n?ne.classList.remove("opacity-50"):ne.classList.add("opacity-50")});N.addEventListener("click",async()=>{b.press(N,.95,100),v.trigger("success");const n=I.map((o,s)=>o.clicked?s:null).filter(o=>o!==null),e=j.checked,t=parseInt(Q.value)||3,i={sequence:n,isLoop:e,loopInterval:t};try{if(window.modalManager.isEditMode){const o=await K(),s=Array.isArray(window.modalManager.originalSequenceData)?window.modalManager.originalSequenceData:window.modalManager.originalSequenceData.sequence||window.modalManager.originalSequenceData.seq,a=o.findIndex(r=>{const l=Array.isArray(r)?r:r.sequence||r.seq;return JSON.stringify(l)===JSON.stringify(s)});if(a!==-1){if(await Ve(a,i),window.audioSystem&&window.audioSystem.isSequenceLooping&&window.audioSystem.isSequenceLooping(s,window.modalManager.editingThumbnail)){const r=window.modalManager.originalSequenceData.loopInterval||3;window.audioSystem.toggleLoopPlayback(s,r,window.modalManager.editingThumbnail)}window.modalManager.editingThumbnail.removeAttribute("data-editing"),window.modalManager.editingThumbnail.remove(),se(i),console.log("âœ… Sequence updated successfully")}else throw new Error("Original sequence not found in storage")}else await Je(i),se(i),console.log("âœ… New sequence saved successfully");await x.handleSaveClick(),le()}catch(o){console.error("âŒ Failed to save sequence:",o),alert("Failed to save sequence. Please try again.")}});function le(){re(),D.classList.add("hidden"),D.classList.remove("flex"),D.setAttribute("aria-hidden","true"),window.modalManager.isEditMode&&window.modalManager.editingThumbnail&&window.modalManager.editingThumbnail.removeAttribute("data-editing"),window.modalManager.isEditMode=!1,window.modalManager.editingThumbnail=null,window.modalManager.originalSequenceData=null,I.forEach(n=>n.clicked=!1),U.disabled=!0,U.classList.remove("highlight-once"),N.disabled=!0,x.cleanupTutorialState(),j.checked=!1,Q.value=3,Q.disabled=!0,ne.style.opacity="0.5",window.modalHighlight&&window.modalHighlight.clearModalHighlights(),te.length=0,R()}const Ie=document.getElementById("closeModalBtn");Ie.addEventListener("click",()=>{b.press(Ie,.9,100),v.trigger("light"),le()});D.addEventListener("click",n=>{n.target===D&&le()});const Et=document.getElementById("modalContent");Et.addEventListener("click",n=>{n.stopPropagation()});document.addEventListener("keydown",n=>{n.key==="Escape"&&!D.classList.contains("hidden")&&le()});function qe(n,e){const t=Date.now()-n,i=Math.min(t/e,1),o=4,s=Math.max(0,1-i),a=Math.sin(t*o/100)*.3+.7;return s*a}window.modalManager=new Oe;class Ae{constructor(){this.highContrastMode=localStorage.getItem("swarm-high-contrast")==="true",this.init()}init(){this.highContrastMode&&this.enableHighContrast();const e=document.getElementById("highContrastBtn");e&&e.addEventListener("click",()=>{this.toggleHighContrast()}),document.addEventListener("keydown",t=>{t.ctrlKey&&t.altKey&&t.key==="c"&&(t.preventDefault(),this.toggleHighContrast())}),this.addKeyboardShortcutInstructions()}toggleHighContrast(){this.highContrastMode=!this.highContrastMode,localStorage.setItem("swarm-high-contrast",this.highContrastMode.toString()),this.highContrastMode?this.enableHighContrast():this.disableHighContrast(),this.announceContrastChange()}enableHighContrast(){document.body.classList.add("high-contrast");const e=document.getElementById("highContrastBtn");e&&(e.setAttribute("aria-pressed","true"),e.title="Disable high contrast mode")}disableHighContrast(){document.body.classList.remove("high-contrast");const e=document.getElementById("highContrastBtn");e&&(e.setAttribute("aria-pressed","false"),e.title="Enable high contrast mode")}announceContrastChange(){const e=document.getElementById("canvas-announcements");e&&(e.textContent=this.highContrastMode?"High contrast mode enabled":"High contrast mode disabled")}addKeyboardShortcutInstructions(){const e=document.createElement("div");e.className="sr-only",e.innerHTML=`
      <h3>Keyboard Shortcuts</h3>
      <ul>
        <li>Ctrl+Alt+C: Toggle high contrast mode</li>
        <li>Arrow keys: Navigate sound grid</li>
        <li>Space/Enter: Activate sounds</li>
        <li>Home: Return to center circle</li>
        <li>Tab: Navigate interface elements</li>
        <li>Escape: Close modals</li>
      </ul>
    `,document.body.appendChild(e)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.accessibilityManager=new Ae}):window.accessibilityManager=new Ae;(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.protocol==="file:")&&Ye(()=>import("./dev-tools-9zE5FD3-.js"),[]).catch(n=>{console.log("Dev tools not loaded (production build)")});console.log("ðŸŽµ Swarm Rippler app initialized");export{J as o};
