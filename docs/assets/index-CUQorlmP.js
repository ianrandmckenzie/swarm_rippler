(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();const He="modulepreload",Qe=function(i){return"/"+i},ye={},_e=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let a=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),r=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));s=a(t.map(c=>{if(c=Qe(c),c in ye)return;ye[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":He,d||(h.as="script"),h.crossOrigin="",h.href=c,r&&h.setAttribute("nonce",r),document.head.appendChild(h),d)return new Promise((m,w)=>{h.addEventListener("load",m),h.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(a){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=a,window.dispatchEvent(l),!l.defaultPrevented)throw a}return s.then(a=>{for(const l of a||[])l.status==="rejected"&&o(l.reason);return e().catch(o)})},Fe="clickRippleDB",$e=1;function N(){return new Promise((i,e)=>{const t=indexedDB.open(Fe,$e);t.onupgradeneeded=n=>{const s=n.target.result;s.objectStoreNames.contains("settings")||s.createObjectStore("settings"),s.objectStoreNames.contains("sequences")||s.createObjectStore("sequences",{autoIncrement:!0})},t.onsuccess=n=>i(n.target.result),t.onerror=n=>e(n.target.error)})}async function me(i){const e=await N();return new Promise(t=>{const s=e.transaction("settings","readonly").objectStore("settings").get(i);s.onsuccess=()=>t(s.result),s.onerror=()=>t(null)})}async function re(i,e){(await N()).transaction("settings","readwrite").objectStore("settings").put(e,i)}async function Ne(i){const t=(await N()).transaction("sequences","readwrite");let n;Array.isArray(i)?n={sequence:i,isLoop:!1,loopInterval:3}:n=i,t.objectStore("sequences").add(n)}async function X(){const i=await N();return new Promise(e=>{const n=i.transaction("sequences","readonly").objectStore("sequences").getAll();n.onsuccess=()=>e(n.result||[]),n.onerror=()=>e([])})}async function Te(){return await me("preferences")||{theme:"system",volume:.7,showTutorial:!0}}async function Xe(i){await re("preferences",i)}async function ze(i,e){const s=(await N()).transaction("sequences","readwrite").objectStore("sequences");return new Promise((o,a)=>{const l=s.getAll();l.onsuccess=()=>{const r=l.result||[];if(i>=0&&i<r.length){const c=s.put(e,i+1);c.onsuccess=()=>{console.log("Sequence updated successfully"),o()},c.onerror=()=>{console.error("Failed to update sequence:",c.error),a(c.error)}}else a(new Error("Invalid sequence index"))},l.onerror=()=>{console.error("Failed to get sequences for update:",l.error),a(l.error)}})}async function Ye(i){const n=(await N()).transaction("sequences","readwrite").objectStore("sequences");return new Promise((s,o)=>{const a=n.getAll();a.onsuccess=()=>{const l=a.result||[];if(i>=0&&i<l.length){const r=n.clear();r.onsuccess=()=>{const c=l.filter((u,h)=>h!==i);let d=0;if(c.length===0){console.log("Sequence deleted successfully (store now empty)"),s();return}c.forEach((u,h)=>{const m=n.add(u,h+1);m.onsuccess=()=>{d++,d===c.length&&(console.log("Sequence deleted successfully"),s())},m.onerror=()=>{console.error("Failed to re-add sequence:",m.error),o(m.error)}})},r.onerror=()=>{console.error("Failed to clear store for deletion:",r.error),o(r.error)}}else o(new Error("Invalid sequence index"))},a.onerror=()=>{console.error("Failed to get sequences for deletion:",a.error),o(a.error)}})}class Ue{constructor(){this.isSupported=this.checkSupport()}checkSupport(){var e;return!!(navigator.vibrate||window.DeviceMotionEvent||window.TapticEngine||(e=window.__TAURI__)!=null&&e.invoke)}trigger(e="light",t=.5){var o;if(!this.isSupported)return;const n={light:[10],medium:[20],heavy:[40],radian:[15,10,15],select:[8],success:[25,15,25]},s=n[e]||n.light;try{navigator.vibrate?navigator.vibrate(s):window.TapticEngine?window.TapticEngine.impact({style:e}):(o=window.__TAURI__)!=null&&o.invoke&&window.__TAURI__.invoke("haptic_feedback",{type:e,intensity:t})}catch(a){console.debug("Haptic feedback not available:",a)}}radianFeedback(e){const t=[.3,.5,.7],n=e%3;this.trigger("radian",t[n])}}class v{static bounce(e,t=1.05,n=150){e&&(e.style.transition=`transform ${n}ms cubic-bezier(0.68, -0.55, 0.265, 1.55)`,e.style.transform=`scale(${t})`,setTimeout(()=>{e.style.transform="scale(1)",setTimeout(()=>{e.style.transition="",e.style.transform=""},n)},n))}static press(e,t=.95,n=100){e&&(e.style.transition=`transform ${n}ms ease-out`,e.style.transform=`scale(${t})`,setTimeout(()=>{e.style.transform="scale(1)",setTimeout(()=>{e.style.transition="",e.style.transform=""},n)},n))}static pulse(e,t=null,n=300){if(!e)return;t||(t=document.documentElement.classList.contains("dark")?"rgba(255, 241, 118, 0.6)":"rgba(255, 235, 59, 0.6)");const s=e.style.boxShadow;e.style.transition=`box-shadow ${n}ms ease-out`,e.style.boxShadow=`0 0 20px 4px ${t}`,setTimeout(()=>{e.style.boxShadow=s,setTimeout(()=>{e.style.transition=""},n)},n)}static canvasRipple(e,t,n,s=null){if(!e)return;s||(s=(window.themeManager?window.themeManager.getEffectiveTheme():"light")==="dark"?"rgba(255, 255, 255, 0.8)":"rgba(0, 0, 0, 0.8)");const o=document.createElement("div");if(o.style.position="absolute",o.style.left=`${t-10}px`,o.style.top=`${n-10}px`,o.style.width="20px",o.style.height="20px",o.style.borderRadius="50%",o.style.background=s,o.style.pointerEvents="none",o.style.animation="feedback-ripple 0.6s ease-out forwards",o.style.zIndex="1000",!document.getElementById("feedback-styles")){const l=document.createElement("style");l.id="feedback-styles",l.textContent=`
        @keyframes feedback-ripple {
          0% {
            transform: scale(0);
            opacity: 1;
          }
          100% {
            transform: scale(4);
            opacity: 0;
          }
        }
      `,document.head.appendChild(l)}const a=e.closest('[id*="container"]')||e.parentElement;a&&(a.style.position="relative",a.appendChild(o),setTimeout(()=>{o.parentElement&&o.parentElement.removeChild(o)},600))}}const M=new Ue;window.feedbackSystem={haptic:M,visual:v};class je{constructor(){this.themes=["light","dark","system"],this.currentTheme="system",this.init()}async init(){await this.loadThemePreference(),this.applyTheme(this.currentTheme),this.setupEventListeners(),this.setupSystemThemeListener(),this.updateThemeButtons(),await new Promise(e=>setTimeout(e,50)),this.initialized=!0,window.dispatchEvent(new CustomEvent("themeManagerReady"))}async loadThemePreference(){try{const e=await Te();this.currentTheme=e.theme||"system"}catch{console.log("No stored theme preference, using system default"),this.currentTheme="system"}}async saveThemePreference(e){try{const t=await Te();t.theme=e,await Xe(t)}catch(t){console.error("Failed to save theme preference:",t)}}setupEventListeners(){document.querySelectorAll("button[data-theme]").forEach(t=>{const n=t.dataset.theme;t.addEventListener("click",s=>{const o=s.currentTarget.dataset.theme;v.bounce(t,1.08,150),M.trigger("light"),this.setTheme(o),window.innerWidth<640&&this.showMobileTooltip(t,o)}),t.addEventListener("mouseenter",s=>{window.innerWidth>=640&&this.showThemeTooltip(s.currentTarget,n)}),t.addEventListener("mouseleave",()=>{window.innerWidth>=640&&this.hideTooltip()})})}setupSystemThemeListener(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{this.currentTheme==="system"&&this.applySystemTheme()})}async setTheme(e){this.themes.includes(e)&&(this.currentTheme=e,await this.saveThemePreference(e),this.applyTheme(e),this.updateThemeButtons())}applyTheme(e){const t=document.documentElement;t.classList.remove("dark","light"),e==="dark"?t.classList.add("dark"):e==="light"?t.classList.add("light"):e==="system"&&this.applySystemTheme(),this.updateMetaThemeColor(e),window.audioSystem&&window.audioSystem.updateThumbnailLoopStates&&window.audioSystem.updateThumbnailLoopStates()}applySystemTheme(){const e=document.documentElement,t=window.matchMedia("(prefers-color-scheme: dark)").matches;e.classList.remove("dark","light"),t?e.classList.add("dark"):e.classList.add("light"),window.audioSystem&&window.audioSystem.updateThumbnailLoopStates&&window.audioSystem.updateThumbnailLoopStates()}updateMetaThemeColor(e){const t=document.querySelector('meta[name="theme-color"]'),n=document.querySelector('meta[name="msapplication-TileColor"]');let s;e==="dark"||e==="system"&&window.matchMedia("(prefers-color-scheme: dark)").matches?s="#232323":s="#1F1F1F",t&&t.setAttribute("content",s),n&&n.setAttribute("content",s)}updateThemeButtons(){document.querySelectorAll("button[data-theme]").forEach(t=>{if(t.classList.remove("bg-swarmshadow-200","text-swarmlight-100","ring-2","ring-swarmlight-300","bg-swarmlight-300","text-swarmshadow-200","ring-swarmshadow-200","bg-swarmlight-200","text-black","text-white","font-semibold"),t.classList.remove("active"),t.dataset.theme===this.currentTheme){const n=t.dataset.theme,s=document.documentElement.classList.contains("dark");n==="dark"?t.classList.add("bg-swarmshadow-200","text-swarmlight-100"):n==="light"?t.classList.add("bg-swarmlight-300","text-swarmshadow-200"):n==="system"&&(t.classList.add("ring-2","font-semibold"),s?(t.classList.add("text-white","ring-swarmlight-600","dark:hover:text-swarmlight-50"),t.classList.remove("dark:hover:text-black")):t.classList.add("text-black","ring-swarmlight-300"),s?t.style.background="linear-gradient(45deg, #706A43 50%, #232323 50%)":t.style.background="linear-gradient(45deg, #FFFDE7 50%, #FFEE58 50%)"),n!=="system"&&(t.classList.add("ring-2"),s?t.classList.add("ring-swarmlight-600"):t.classList.add("ring-swarmlight-300"))}else t.dataset.theme==="system"&&(t.classList.add("dark:hover:text-black"),t.classList.remove("dark:hover:text-swarmlight-50"),t.style.background="")})}getCurrentTheme(){return this.currentTheme}getEffectiveTheme(){return this.currentTheme==="system"?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":this.currentTheme}getThemeDescription(e){switch(e){case"light":return"Light theme - bright interface";case"dark":return"Dark theme - dark interface";case"system":return"System theme - follows your device settings";default:return"Theme option"}}showThemeTooltip(e,t){const n=this.getThemeDescription(t);if(window.showTooltip){const o=e.closest(".theme-switcher")||e;window.showTooltip(n,o,0)}}showMobileTooltip(e,t){const n=this.getThemeDescription(t);if(window.showTooltip){const o=e.closest(".theme-switcher")||e;window.showTooltip(n,o,0),setTimeout(()=>{window.hideTooltip&&window.hideTooltip()},2e3)}}hideTooltip(){window.hideTooltip&&window.hideTooltip()}}document.addEventListener("DOMContentLoaded",()=>{window.themeManager=new je});const _=5;class Je{constructor(){this.tutorialMode=!1,this.isActive=!1,this.currentStep=0,this.elements=this.initializeElements(),this.setupWelcomeModal(),setTimeout(()=>this.checkAndShowTutorial(),100)}initializeElements(){return{createBtn:document.getElementById("createSequenceBtn"),tutorialCounter:document.getElementById("tutorialCounter"),targetCountEl:document.getElementById("targetCount"),selectedCountEl:document.getElementById("selectedCount"),modalInstruction:document.getElementById("modalInstruction"),testBtn:document.getElementById("testSequenceBtn"),saveBtn:document.getElementById("saveSequenceBtn"),tutorialOverlay:document.getElementById("tutorialOverlay"),welcomeModal:document.getElementById("tutorialWelcomeModal"),beginBtn:document.getElementById("beginTutorialBtn"),beginBtnMobile:document.getElementById("beginTutorialBtnMobile"),welcomeSteps:document.getElementById("welcomeSteps"),welcomeStepsContainer:document.getElementById("welcomeStepsContainer"),dots:[document.getElementById("dot0"),document.getElementById("dot1"),document.getElementById("dot2")]}}setupWelcomeModal(){this.elements.beginBtn&&this.elements.beginBtn.addEventListener("click",()=>{this.handleBeginClick(this.elements.beginBtn)}),this.elements.beginBtnMobile&&this.elements.beginBtnMobile.addEventListener("click",()=>{this.handleBeginClick(this.elements.beginBtnMobile)}),this.setupMobileSwipe(),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.isWelcomeModalOpen()&&(this.closeWelcomeModal(),this.startMainTutorial())})}handleBeginClick(e){v.press(e,.95,150),M.trigger("medium"),this.closeWelcomeModal(),this.startMainTutorial()}setupMobileSwipe(){if(!this.elements.welcomeStepsContainer)return;let e=0,t=0,n=!1;const s=l=>{e=l.touches?l.touches[0].clientX:l.clientX,t=l.touches?l.touches[0].clientY:l.clientY,n=!0},o=l=>{n&&l.preventDefault()},a=l=>{if(!n)return;n=!1;const r=l.changedTouches?l.changedTouches[0].clientX:l.clientX,c=l.changedTouches?l.changedTouches[0].clientY:l.clientY,d=e-r,u=Math.abs(t-c);Math.abs(d)>50&&u<100&&(d>0?this.nextStep():this.previousStep())};this.elements.welcomeStepsContainer.addEventListener("touchstart",s,{passive:!1}),this.elements.welcomeStepsContainer.addEventListener("touchmove",o,{passive:!1}),this.elements.welcomeStepsContainer.addEventListener("touchend",a,{passive:!1}),this.elements.welcomeStepsContainer.addEventListener("mousedown",s),this.elements.welcomeStepsContainer.addEventListener("mousemove",o),this.elements.welcomeStepsContainer.addEventListener("mouseup",a)}nextStep(){this.currentStep<2&&(this.currentStep++,this.updateStepDisplay())}previousStep(){this.currentStep>0&&(this.currentStep--,this.updateStepDisplay())}updateStepDisplay(){if(this.elements.welcomeSteps){const e=-this.currentStep*100;this.elements.welcomeSteps.style.transform=`translateX(${e}%)`}this.elements.dots.forEach((e,t)=>{e&&(t===this.currentStep?(e.classList.remove("opacity-50"),e.classList.add("opacity-100")):(e.classList.remove("opacity-100"),e.classList.add("opacity-50")))})}async checkAndShowTutorial(){try{const e=await me("tutorialSeen"),t=await X();!e&&t.length===0&&this.showWelcomeModal()}catch(e){console.log("Could not check tutorial state:",e)}}showWelcomeModal(){this.elements.welcomeModal&&(this.elements.welcomeModal.classList.remove("hidden"),this.elements.welcomeModal.classList.add("flex"),this.elements.welcomeModal.setAttribute("aria-hidden","false"),this.currentStep=0,this.updateStepDisplay(),setTimeout(()=>{const t=window.innerWidth<640?this.elements.beginBtnMobile:this.elements.beginBtn;t&&this.currentStep===2&&t.focus()},100))}closeWelcomeModal(){this.elements.welcomeModal&&(this.elements.welcomeModal.classList.add("hidden"),this.elements.welcomeModal.classList.remove("flex"),this.elements.welcomeModal.setAttribute("aria-hidden","true"),this.currentStep=0,this.updateStepDisplay())}isWelcomeModalOpen(){return this.elements.welcomeModal&&!this.elements.welcomeModal.classList.contains("hidden")}startMainTutorial(){this.isActive=!0,document.body.classList.add("tutorial-active"),this.elements.createBtn.classList.add("highlight-once"),window.showTooltip&&window.showTooltip("Start playing by clicking New Sequence!",this.elements.createBtn)}startTutorial(){this.showWelcomeModal()}enableTutorialMode(){this.tutorialMode=!0,this.elements.tutorialCounter&&(this.elements.tutorialCounter.classList.remove("hidden"),this.elements.targetCountEl.textContent=_,this.elements.selectedCountEl.textContent="0")}disableTutorialMode(){this.tutorialMode=!1,this.elements.tutorialCounter&&this.elements.tutorialCounter.classList.add("hidden")}updateTutorialUI(e){if(this.tutorialMode&&(this.elements.selectedCountEl&&(this.elements.selectedCountEl.textContent=e),this.elements.modalInstruction))if(e===0)this.elements.modalInstruction.textContent="Click the empty circles to form your sequence",this.elements.modalInstruction.classList.remove("hidden"),this.hideTooltip();else if(e<_){const t=_-e;this.elements.modalInstruction.textContent=`Select ${t} more circle${t===1?"":"s"}`,this.elements.modalInstruction.classList.remove("hidden"),this.hideTooltip()}else e===_&&(this.elements.modalInstruction.classList.add("hidden"),this.hideTooltip())}updateButtonStates(e){return this.tutorialMode?(e===_?this.elements.testBtn&&(this.elements.testBtn.disabled=!1,this.elements.testBtn.classList.add("highlight-once"),window.showTooltip&&window.showTooltip("Click Test to hear what your sequence sounds like!",this.elements.testBtn)):this.elements.testBtn&&(this.elements.testBtn.disabled=!0,this.elements.testBtn.classList.remove("highlight-once"),this.hideTooltip()),this.updateTutorialUI(e),!0):!1}async handleTestClick(){return this.tutorialMode?(this.hideTooltip(),this.elements.testBtn&&this.elements.testBtn.classList.remove("highlight-once"),this.elements.saveBtn&&(this.elements.saveBtn.disabled=!1),await this.completeTutorial(),!0):!1}async handleSaveClick(){return this.tutorialMode?(await this.completeTutorial(),!0):!1}async completeTutorial(){try{await re("tutorialSeen",!0),this.tutorialMode=!1,this.isActive=!1,document.body.classList.remove("tutorial-active"),this.elements.createBtn&&this.elements.createBtn.classList.remove("highlight-once"),this.closeWelcomeModal()}catch(e){console.error("Error completing tutorial:",e)}}async resetTutorial(){try{return await re("tutorialSeen",!1),this.tutorialMode=!1,this.isActive=!1,document.body.classList.remove("tutorial-active"),this.elements.createBtn&&this.elements.createBtn.classList.remove("highlight-once"),this.elements.tutorialCounter&&this.elements.tutorialCounter.classList.add("hidden"),this.elements.modalInstruction&&this.elements.modalInstruction.classList.add("hidden"),this.closeWelcomeModal(),console.log("âœ… Tutorial state reset"),!0}catch(e){return console.error("âŒ Error resetting tutorial:",e),!1}}cleanupTutorialState(){this.tutorialMode=!1,this.elements.tutorialCounter&&this.elements.tutorialCounter.classList.add("hidden"),this.elements.modalInstruction&&this.elements.modalInstruction.classList.add("hidden"),this.elements.testBtn&&this.elements.testBtn.classList.remove("highlight-once"),this.hideTooltip()}hideTooltip(){window.hideTooltip&&window.hideTooltip()}get isTutorialMode(){return this.tutorialMode}get isTutorialActive(){return this.isActive}get targetCount(){return _}}const L=new Je;window.tutorialManager=L;class Me{constructor(){this.sidenav=document.getElementById("sidenav"),this.toggleBtn=document.getElementById("sidenavToggle"),this.closeBtn=document.getElementById("sidenavClose"),this.infoBtn=document.getElementById("infoBtn"),this.resetTutorialBtn=document.getElementById("resetTutorialBtn"),this.appInfoModal=document.getElementById("appInfoModal"),this.closeAppInfoBtn=document.getElementById("closeAppInfoBtn"),this.isOpen=!1,this.init()}init(){this.setupEventListeners(),this.setupTooltips()}setupEventListeners(){this.toggleBtn.addEventListener("click",()=>{v.bounce(this.toggleBtn,1.1,120),M.trigger("light"),this.toggle()}),this.closeBtn.addEventListener("click",()=>{v.press(this.closeBtn,.9,100),M.trigger("light"),this.close()}),this.infoBtn.addEventListener("click",()=>{v.bounce(this.infoBtn,1.1,120),M.trigger("light"),this.openAppInfoModal()}),this.resetTutorialBtn.addEventListener("click",()=>{v.bounce(this.resetTutorialBtn,1.1,120),M.trigger("medium"),this.resetTutorial()}),this.closeAppInfoBtn.addEventListener("click",()=>{v.press(this.closeAppInfoBtn,.95,100),M.trigger("light"),this.closeAppInfoModal()}),this.appInfoModal.addEventListener("click",e=>{e.target===this.appInfoModal&&this.closeAppInfoModal()}),document.addEventListener("click",e=>{this.isOpen&&!this.sidenav.contains(e.target)&&!this.toggleBtn.contains(e.target)&&this.close()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&(this.appInfoModal&&!this.appInfoModal.classList.contains("hidden")?this.closeAppInfoModal():this.isOpen&&this.close())})}setupTooltips(){this.infoBtn.addEventListener("mouseenter",()=>{window.showTooltip&&window.innerWidth>=640&&window.showTooltip("App information",this.infoBtn)}),this.infoBtn.addEventListener("mouseleave",()=>{window.hideTooltip&&window.innerWidth>=640&&window.hideTooltip()}),this.resetTutorialBtn.addEventListener("mouseenter",()=>{window.showTooltip&&window.innerWidth>=640&&window.showTooltip("Reset tutorial",this.resetTutorialBtn)}),this.resetTutorialBtn.addEventListener("mouseleave",()=>{window.hideTooltip&&window.innerWidth>=640&&window.hideTooltip()}),this.toggleBtn.addEventListener("mouseenter",()=>{if(window.showTooltip&&window.innerWidth>=640){const e=this.isOpen?"Close side panel":"Open side panel";window.showTooltip(e,this.toggleBtn)}}),this.toggleBtn.addEventListener("mouseleave",()=>{window.hideTooltip&&window.innerWidth>=640&&window.hideTooltip()}),this.closeBtn.addEventListener("mouseenter",()=>{window.showTooltip&&window.innerWidth>=640&&window.showTooltip("Close side panel",this.closeBtn)}),this.closeBtn.addEventListener("mouseleave",()=>{window.hideTooltip&&window.innerWidth>=640&&window.hideTooltip()})}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen=!0,this.sidenav.classList.remove("translate-x-full"),this.sidenav.classList.add("translate-x-0"),this.updateToggleButton()}close(){this.isOpen=!1,this.sidenav.classList.remove("translate-x-0"),this.sidenav.classList.add("translate-x-full"),this.updateToggleButton(),window.hideTooltip&&window.hideTooltip()}updateToggleButton(){const e=this.toggleBtn.querySelector("svg path");this.isOpen?(e.setAttribute("d","M15 19l-7-7 7-7"),this.toggleBtn.setAttribute("title","Close side panel"),this.toggleBtn.setAttribute("aria-label","Close side panel")):(e.setAttribute("d","M9 5l7 7-7 7"),this.toggleBtn.setAttribute("title","Open side panel"),this.toggleBtn.setAttribute("aria-label","Open side panel"))}async resetTutorial(){try{if(await L.resetTutorial())window.showTooltip&&(window.showTooltip("Tutorial reset! Reload page to see tutorial.",this.resetTutorialBtn),setTimeout(()=>{window.hideTooltip&&window.hideTooltip()},3e3)),setTimeout(()=>{confirm("Tutorial has been reset! Would you like to reload the page to see the tutorial?")&&window.location.reload()},500);else throw new Error("Failed to reset tutorial")}catch(e){console.error("Error resetting tutorial:",e),window.showTooltip&&(window.showTooltip("Error resetting tutorial. Please try again.",this.resetTutorialBtn),setTimeout(()=>{window.hideTooltip&&window.hideTooltip()},3e3))}}openAppInfoModal(){this.appInfoModal&&(this.appInfoModal.classList.remove("hidden"),this.appInfoModal.classList.add("flex"),this.appInfoModal.setAttribute("aria-hidden","false"),this.close(),setTimeout(()=>{this.closeAppInfoBtn.focus()},100))}closeAppInfoModal(){this.appInfoModal&&(this.appInfoModal.classList.add("hidden"),this.appInfoModal.classList.remove("flex"),this.appInfoModal.setAttribute("aria-hidden","true"),this.infoBtn.focus())}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{window.sidenavManager=new Me}):window.sidenavManager=new Me;const T=document.getElementById("soundCanvas"),g=T.getContext("2d"),I=window.devicePixelRatio||1;let P=new Map;const z=new Audio("./assets/5.mp3"),Y=[{dirX:0,dirY:-1,audio:new Audio("./assets/2.mp3")},{dirX:0,dirY:1,audio:new Audio("./assets/8.mp3")},{dirX:-1,dirY:0,audio:new Audio("./assets/4.mp3")},{dirX:1,dirY:0,audio:new Audio("./assets/6.mp3")},{dirX:1/Math.SQRT2,dirY:-1/Math.SQRT2,audio:new Audio("./assets/3.mp3")},{dirX:-1/Math.SQRT2,dirY:-1/Math.SQRT2,audio:new Audio("./assets/1.mp3")},{dirX:-1/Math.SQRT2,dirY:1/Math.SQRT2,audio:new Audio("./assets/7.mp3")},{dirX:1/Math.SQRT2,dirY:1/Math.SQRT2,audio:new Audio("./assets/9.mp3")}];function Ve(){const i=T.clientWidth,e=T.clientHeight;T.width=i*I,T.height=e*I,g.resetTransform(),g.scale(I,I)}function Ge(){Ve();const i=T.clientWidth,e=T.clientHeight,t=i/2,n=e/2,s=Math.min(i,e),o=.4,a=s*.15*o,l=a*.4,r=a+l+s*.12*o;if(g.clearRect(0,0,i,e),g.beginPath(),g.arc(t,n,a,0,Math.PI*2),g.lineWidth=l,P.has(-1)){const{startTime:d,duration:u}=P.get(-1),h=ve(d,u);if(h>0){const m=Math.floor(255*h),w=Math.floor(107*h),y=Math.floor(107*h);g.strokeStyle=`rgb(${m}, ${w}, ${y})`}else{const m=window.themeManager?window.themeManager.getEffectiveTheme():"light";g.strokeStyle=m==="dark"?"#fff":"#000",P.delete(-1)}}else{const d=window.themeManager?window.themeManager.getEffectiveTheme():"light";g.strokeStyle=d==="dark"?"#fff":"#000"}g.stroke(),[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0},{x:1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:-1/Math.SQRT2},{x:1/Math.SQRT2,y:1/Math.SQRT2},{x:-1/Math.SQRT2,y:1/Math.SQRT2}].forEach((d,u)=>{for(let h=1;h<=3;h++){const m=t+d.x*r*h,w=n+d.y*r*h,y=u*3+(h-1);if(g.beginPath(),g.arc(m,w,l,0,Math.PI*2),P.has(y)){const{startTime:p,duration:E}=P.get(y),b=ve(p,E);if(b>0){const S=Math.floor(255*b),D=Math.floor(107*b),q=Math.floor(107*b);g.fillStyle=`rgb(${S}, ${D}, ${q})`,g.fill(),g.strokeStyle="#fff",g.lineWidth=2,g.stroke()}else{P.delete(y);const S=window.themeManager?window.themeManager.getEffectiveTheme():"light";g.fillStyle=S==="dark"?"#fff":"#000",g.fill()}}else{const p=window.themeManager?window.themeManager.getEffectiveTheme():"light";g.fillStyle=p==="dark"?"#fff":"#000",g.fill()}}})}let U=[];const Ke=.006,Ze=.016;T.addEventListener("click",i=>{const e=T.getBoundingClientRect(),t=T.clientWidth,n=T.clientHeight,s=i.clientX-e.left,o=i.clientY-e.top,a=t/2,l=n/2,r=Math.min(t,n),c=.4,d=r*.15*c;if((s-a)**2+(o-l)**2<=d*d){v.canvasRipple(T,s,o),M.trigger("medium"),U.push({x:a,y:l,radius:d,alpha:1}),z.currentTime=0,z.play();return}const u=d*.4,h=d+u+r*.12*c;for(const{dirX:m,dirY:w,audio:y}of Y)for(let p=1;p<=3;p++){const E=a+m*h*p,b=l+w*h*p;if((s-E)**2+(o-b)**2<=u*u){v.canvasRipple(T,s,o),M.trigger("light"),y.currentTime=0,y.play();return}}});function et(){const e=Math.min(T.clientWidth,T.clientHeight)*Ke,n=(window.themeManager?window.themeManager.getEffectiveTheme():"light")==="dark"?"255,255,255":"0,0,0";U.forEach((s,o)=>{g.beginPath(),g.arc(s.x,s.y,s.radius,0,Math.PI*2),g.strokeStyle=`rgba(${n},${s.alpha})`,g.lineWidth=2,g.stroke(),s.radius+=e,s.alpha-=Ze,s.alpha<=0&&U.splice(o,1)})}function xe(){Ge(),et(),requestAnimationFrame(xe)}function tt(i,e=500){const t=Date.now();P.set(i,{startTime:t,duration:e})}function nt(){P.clear()}window.canvasHighlight={highlightCircle:tt,clearAllHighlights:nt};function ve(i,e){const t=Date.now()-i,n=Math.min(t/e,1),s=4,o=Math.max(0,1-n),a=Math.sin(t*s/100)*.3+.7;return o*a}xe();const ce={ZERO:0,ONE:.25,TWO:.5,THREE:.75},it=.01;let oe=null;function Be(){return oe||(oe=new(window.AudioContext||window.webkitAudioContext)),oe}function Ie(i){const e=Math.floor(i/3),t=i%3;return{radian:t+1,direction:e,position:t}}function st(i){const e=Math.floor(i/3);return Y[e]?Y[e].audio:null}function ot(){if(U&&T){const i=T.clientWidth/2,e=T.clientHeight/2,s=Math.min(T.clientWidth,T.clientHeight)*.15*.4;U.push({x:i,y:e,radius:s,alpha:1})}}async function K(i,e={}){if(!i||i.length===0){console.warn("No sequence to play");return}const{inModal:t=!1}=e,n=Be();n.state==="suspended"&&await n.resume(),window.canvasHighlight&&window.canvasHighlight.clearAllHighlights(),t&&window.modalHighlight&&window.modalHighlight.clearModalHighlights();const s={0:[],1:[],2:[],3:[]};i.forEach(o=>{const{radian:a}=Ie(o);s[a].push(o)}),ot(),t&&window.modalHighlight&&window.modalHighlight.createModalRipple(),z&&setTimeout(()=>{z.currentTime=0,z.play().catch(o=>console.warn("Failed to play droplet sound:",o)),window.canvasHighlight&&window.canvasHighlight.highlightCircle(-1,400),t&&window.modalHighlight&&window.modalHighlight.highlightModalCircle(-1,400)},0),Object.keys(s).forEach(o=>{const a=s[o];if(a.length===0)return;const l=parseInt(o),r=ce[Object.keys(ce)[l]]*1e3;a.forEach((c,d)=>{const u=st(c);if(u){const h=r+d*it*1e3;setTimeout(()=>{u.currentTime=0,u.play().catch(m=>console.warn(`Failed to play audio for circle ${c}:`,m)),M.radianFeedback(l),window.canvasHighlight&&window.canvasHighlight.highlightCircle(c,600),t&&window.modalHighlight&&window.modalHighlight.highlightModalCircle(c,600)},h)}})})}const Z=5;let W=new Map;function Ce(i,e){return i||JSON.stringify(e)}function fe(i,e,t=null){const n=Ce(t,i);if(W.has(n)){const s=W.get(n);clearInterval(s.timer),W.delete(n),console.log("ðŸ”„ Loop playback stopped for thumbnail"),de(),j()}else{if(W.size>=Z){console.warn(`ðŸ”„ Maximum number of concurrent loops (${Z}) reached. Cannot start new loop.`);const o=document.getElementById("loopCounter");if(o){const a=o.className;o.className=o.className.replace(/bg-\S+/g,"bg-red-200 dark:bg-red-800"),o.style.animation="pulse 0.5s ease-in-out 2",setTimeout(()=>{o.className=a,o.style.animation=""},1e3)}return}console.log(`ðŸ”„ Starting loop playback every ${e}s`),K(i);const s=setInterval(async()=>{try{await K(i)}catch(o){console.error("Error in loop playback:",o),fe(i,e,t)}},e*1e3);W.set(n,{timer:s,sequence:i,interval:e,thumbnail:t}),console.log("ðŸ”„ Loop playback started"),de(),j()}}function qe(i,e=null){if(!i)return!1;const t=Ce(e,i);return W.has(t)}function j(){const i=document.getElementById("loopCounter");if(!i)return;const e=W.size;e>0?(i.textContent=`Loops playing: ${e}/${Z}`,i.classList.remove("hidden")):i.classList.add("hidden")}function de(){const i=document.getElementById("sequenceBar");if(!i)return;i.querySelectorAll("canvas").forEach(t=>{const n=t.sequenceData;if(n){const s=qe(n.seq,t),o=document.documentElement.classList.contains("dark");t.classList.remove("bg-swarmstripe-200/50","bg-swarmshadow-50","rounded-lg","transition-colors","duration-300","ease-in-out","loop-pulse-animation","p-2"),t.style.backgroundColor="",t.style.animation="",s&&(t.classList.add("rounded-full","transition-colors","duration-300","ease-in-out","loop-pulse-animation","p-2"),o?t.classList.add("bg-swarmshadow-50"):t.classList.add("bg-swarmstripe-200/50"),t.style.animation="loop-pulse 2s ease-in-out infinite")}})}function he(){if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",he);return}const i=document.getElementById("sequenceBar");if(!i){console.warn("Sequence bar not found, retrying..."),setTimeout(he,100);return}i.addEventListener("click",async e=>{const t=e.target.closest("canvas");if(!t)return;v.bounce(t,1.1,120),M.trigger("light");let n;if(t.sequenceData)n=t.sequenceData;else{const l=Array.from(i.children).indexOf(t);try{n=(await X())[l]}catch(r){console.error("Error loading sequence:",r);return}}if(!n)return;let s,o,a;Array.isArray(n)?(s=n,o=!1,a=3):(s=n.seq||n.sequence,o=n.isLoop||!1,a=n.loopInterval||3);try{o?fe(s,a,t):await K(s)}catch(l){console.error("Error playing sequence:",l)}})}he();document.readyState==="loading"?document.addEventListener("DOMContentLoaded",j):j();window.audioSystem={playSequence:K,initAudioContext:Be,toggleLoopPlayback:fe,isSequenceLooping:qe,updateThumbnailLoopStates:de,updateLoopCounter:j,getRadianInfo:Ie,RADIAN_TIMING:ce,MAX_CONCURRENT_LOOPS:Z,getActiveLoopCount:()=>W.size};const B=document.getElementById("tooltip");function Ae(i,e,t=0){const n=e.getBoundingClientRect(),s=window.innerWidth,o=window.innerHeight;B.textContent=i;const a=e.closest("#sequenceModal")!==null,l=window.__TAURI__!==void 0;let r,c;if(a||s<640){const d=B.offsetWidth||200;if(a){const h=document.getElementById("modalContent").getBoundingClientRect();r=h.left+(h.width-d)/2,c=h.top-40,c<16&&(c=h.top+8)}else r=(s-d)/2,c=n.bottom+8;r=Math.max(8,Math.min(r,s-d-8)),c=Math.max(8,Math.min(c,o-50))}else if(r=n.left+n.width/2-B.offsetWidth/2+t,c=n.bottom+16,l){const d=B.offsetWidth||200,u=B.offsetHeight||40;r=Math.max(16,Math.min(r,s-d-16)),c=Math.max(16,Math.min(c,o-u-16));const h=n.left+n.width/2;Math.abs(r+d/2-h)>100&&(r=h-d/2,r=Math.max(16,Math.min(r,s-d-16)))}else{const d=B.offsetWidth||200;r=Math.max(8,Math.min(r,s-d-8))}B.style.left=r+"px",B.style.top=c+"px",B.classList.remove("hidden"),B.removeAttribute("aria-hidden")}function te(){B.classList.add("hidden"),B.setAttribute("aria-hidden","true")}window.showTooltip=Ae;window.hideTooltip=te;window.showTooltip=Ae;window.hideTooltip=te;function ae(){if(window.themeManager){const i=window.themeManager.getEffectiveTheme(),e=document.documentElement.classList.contains("dark");if(i==="dark"&&e||i==="light"&&!e)return i}return document.documentElement.classList.contains("dark")?"dark":document.documentElement.classList.contains("light")?"light":window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}async function ee(i){var E;const e=document.getElementById("sequenceBar"),t=80,n=document.createElement("canvas");n.width=t*I,n.height=t*I,n.style.width=t+"px",n.style.height=t+"px";const s=n.getContext("2d");s.scale(I,I);let o,a,l;Array.isArray(i)?(o=i,a=!1,l=3):(o=i.sequence||i,a=i.isLoop||!1,l=i.loopInterval||3);const r=3,c=t-r,d=t/2,u=t/2,h=c*.08,m=h*.35,w=h*1.8;s.beginPath(),s.arc(d,u,h,0,2*Math.PI);const y=ae(),p=y==="dark"?"#fff":"#000";if(window.location.hostname==="localhost"&&console.log("Thumbnail generation - Effective theme:",y,"Center color:",p,"DOM dark class:",document.documentElement.classList.contains("dark"),"Theme manager available:",!!window.themeManager,"Theme manager theme:",(E=window.themeManager)==null?void 0:E.getEffectiveTheme()),s.fillStyle=p,s.fill(),Y.forEach(({dirX:b,dirY:S,audio:D},q)=>{for(let A=1;A<=3;A++){const De=[0,1,2,3,4,5,7,6].indexOf(q)*3+(A-1),Oe=o.includes(De),ie=d+b*w*A,se=u+S*w*A;if(ie-m>=r&&ie+m<=t-r&&se-m>=r&&se+m<=t-r){s.beginPath(),s.arc(ie,se,m,0,2*Math.PI);const pe=ae(),Pe=pe==="dark"?"#fff":"#000",We=pe==="dark"?"#000":"#fff";s.fillStyle=Pe,s.strokeStyle=We,s.lineWidth=.5,Oe?s.fill():s.stroke()}}}),n.sequenceData={seq:o,isLoop:a,loopInterval:l},window.audioSystem&&window.audioSystem.isSequenceLooping&&window.audioSystem.isSequenceLooping(o,n)){const S=ae()==="dark";n.classList.add("rounded-full","transition-colors","duration-300","ease-in-out","p-2"),S?n.classList.add("bg-swarmshadow-50"):n.classList.add("bg-swarmstripe-200/50"),n.style.animation="loop-pulse 2s ease-in-out infinite"}e.appendChild(n)}function at(){X().then(i=>{i.forEach(e=>ee(e)),console.log(`âœ… Loaded ${i.length} saved sequences`)}).catch(i=>{console.error("Failed to load sequences:",i)})}function Se(){document.getElementById("sequenceBar").querySelectorAll("canvas").forEach(t=>t.remove()),X().then(t=>{t.forEach(n=>ee(n))}).catch(t=>{console.error("Failed to reload sequences after theme change:",t)})}function lt(){if(window.themeManager&&window.themeManager.initialized){const i=window.themeManager.setTheme.bind(window.themeManager);window.themeManager.setTheme=async function(e){await i(e),Se()}}else window.addEventListener("themeManagerReady",()=>{const i=window.themeManager.setTheme.bind(window.themeManager);window.themeManager.setTheme=async function(e){await i(e),Se()}},{once:!0})}document.addEventListener("DOMContentLoaded",lt);function Ee(){function i(){if(window.themeManager&&window.themeManager.initialized){const e=window.themeManager.getEffectiveTheme(),t=document.documentElement.classList.contains("dark"),n=document.documentElement.classList.contains("light");e==="dark"&&t||e==="light"&&(n||!t&&!n)?at():requestAnimationFrame(i)}else window.addEventListener("themeManagerReady",()=>{requestAnimationFrame(i)},{once:!0})}i()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Ee):Ee();class rt{constructor(){this.contextMenu=null,this.currentThumbnail=null,this.init()}init(){this.contextMenu=document.getElementById("contextMenu"),this.setupEventListeners()}setupEventListeners(){document.addEventListener("click",t=>{this.contextMenu.contains(t.target)||this.hideContextMenu()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&this.hideContextMenu()}),document.getElementById("editSequence").addEventListener("click",()=>{v.press(document.getElementById("editSequence"),.95,100),M.trigger("light"),this.editSequence(),this.hideContextMenu()}),document.getElementById("deleteSequence").addEventListener("click",()=>{v.press(document.getElementById("deleteSequence"),.95,100),M.trigger("medium"),this.deleteSequence(),this.hideContextMenu()});const e=document.getElementById("sequenceBar");e&&e.addEventListener("contextmenu",t=>{const n=t.target.closest("canvas");n&&n.sequenceData&&(t.preventDefault(),this.showContextMenu(t,n))})}showContextMenu(e,t){this.currentThumbnail=t,this.contextMenu.style.visibility="hidden",this.contextMenu.classList.remove("hidden");const n=this.contextMenu.getBoundingClientRect(),s=n.width,o=n.height,a=window.innerWidth,l=window.innerHeight;let r=e.clientX,c=e.clientY;const d=8;r+s+d>a&&(r=r-s,r<d&&(r=a-s-d)),r=Math.max(d,r),c+o+d>l&&(c=c-o,c<d&&(c=l-o-d)),c=Math.max(d,c);const u=document.getElementById("sequenceBar");if(u){const h=u.getBoundingClientRect();e.clientY>=h.top&&c+o>h.top&&(c=Math.max(d,h.top-o-4))}this.contextMenu.style.left=r+"px",this.contextMenu.style.top=c+"px",this.contextMenu.style.visibility="visible"}hideContextMenu(){this.contextMenu.classList.add("hidden"),this.contextMenu.style.visibility="",this.currentThumbnail=null}editSequence(){if(!this.currentThumbnail||!this.currentThumbnail.sequenceData)return;const e=this.currentThumbnail.sequenceData;this.currentThumbnail.setAttribute("data-editing","true"),window.modalManager&&window.modalManager.openEditMode(e,this.currentThumbnail)}async deleteSequence(){if(!this.currentThumbnail||!this.currentThumbnail.sequenceData)return;const e=this.currentThumbnail,t=this.currentThumbnail.sequenceData;if(confirm("Are you sure you want to delete this sequence? This action cannot be undone."))try{const o=(await X()).findIndex(a=>{const l=Array.isArray(a)?a:a.sequence||a.seq,r=Array.isArray(t)?t:t.sequence||t.seq;return JSON.stringify(l)===JSON.stringify(r)});if(o!==-1){if(await Ye(o),e.remove(),window.audioSystem&&window.audioSystem.isSequenceLooping){const a=Array.isArray(t)?t:t.sequence||t.seq;if(window.audioSystem.isSequenceLooping(a,e)){const l=t.loopInterval||3;window.audioSystem.toggleLoopPlayback(a,l,e)}}console.log("âœ… Sequence deleted successfully")}else console.error("âŒ Sequence not found in storage"),alert("Sequence not found in storage. It may have already been deleted.")}catch(s){console.error("âŒ Failed to delete sequence:",s),alert("Failed to delete sequence. Please try again.")}}}document.addEventListener("DOMContentLoaded",()=>{window.contextMenuManager=new rt});const le=document.getElementById("createSequenceBtn"),R=document.getElementById("sequenceModal"),k=document.getElementById("sequenceCanvas"),f=k.getContext("2d"),be=document.getElementById("modalTitle");let O=new Map,J=[];const ct=4,dt=.04;class Re{constructor(){this.isEditMode=!1,this.editingThumbnail=null,this.originalSequenceData=null,this.init()}init(){this.setupEventListeners()}setupEventListeners(){le.addEventListener("click",()=>{v.bounce(le,1.05,150),M.trigger("medium"),this.openCreateMode()})}async openCreateMode(){te(),le.classList.remove("highlight-once"),document.body.classList.remove("tutorial-active"),this.isEditMode=!1,this.editingThumbnail=null,this.originalSequenceData=null,be.textContent="Create New Sequence",await me("tutorialSeen")?L.disableTutorialMode():L.enableTutorialMode(),this.resetModalState(),this.showModal()}openEditMode(e,t){this.isEditMode=!0,this.editingThumbnail=t,this.originalSequenceData=JSON.parse(JSON.stringify(e)),be.textContent="Edit Sequence",L.disableTutorialMode(),this.resetModalState(),this.showModal(),this.loadSequenceIntoModal(e),G(),ue()}resetModalState(){C.forEach(e=>{e.clicked=!1}),$.checked=!1,H.value=3,V.style.opacity="0.5",H.disabled=!0,O.clear(),J.length=0,L.cleanupTutorialState()}loadSequenceIntoModal(e){const t=Array.isArray(e)?e:e.seq||e.sequence||[],n=e.isLoop||!1,s=e.loopInterval||3;$.checked=n,H.value=s,n&&(V.style.opacity="1",H.disabled=!1),t.forEach(o=>{C[o]&&(C[o].clicked=!0)})}showModal(){R.classList.remove("hidden"),R.classList.add("flex"),R.setAttribute("aria-hidden","false"),this.initializeModalCircles(),G(),ge(),L.isTutorialMode&&L.updateTutorialUI(0),ue()}initializeModalCircles(){const e=k.clientWidth,t=k.clientHeight,n=250,s=(e-n)/2,o=(t-n)/2,a=n/2,l=n/2,r=n*.09,c=r*.3,d=r+c*2,u=[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0},{x:1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:-1/Math.SQRT2},{x:1/Math.SQRT2,y:1/Math.SQRT2},{x:-1/Math.SQRT2,y:1/Math.SQRT2}];C=[],u.forEach((h,m)=>{const y=Y[[0,1,2,3,4,5,7,6][m]].audio;for(let p=1;p<=3;p++)C.push({x:s+a+h.x*d*p,y:o+l+h.y*d*p,r:c,audio:y,clicked:!1})})}}function ht(){const i=k.clientWidth,e=k.clientHeight;k.width=i*I,k.height=e*I,f.resetTransform(),f.scale(I,I)}const F=document.getElementById("testSequenceBtn"),Q=document.getElementById("saveSequenceBtn"),$=document.getElementById("loopToggle"),H=document.getElementById("loopInterval"),V=document.getElementById("loopIntervalControls");let C=[];const ut=new Re;window.modalManager=ut;function G(){ht();const i=k.clientWidth,e=k.clientHeight,t=Math.min(250,250);f.clearRect(0,0,i,e),f.save();const n=(i-t)/2,s=(e-t)/2;f.translate(n,s);const o=t/2,a=t/2;mt();const l=t*.09;if(f.beginPath(),f.arc(o,a,l,0,2*Math.PI),O.has(-1)){const{startTime:u,duration:h}=O.get(-1),m=ke(u,h);if(m>0){const w=Math.floor(255*m),y=Math.floor(107*m),p=Math.floor(107*m);f.fillStyle=`rgb(${w}, ${y}, ${p})`}else{const w=window.themeManager?window.themeManager.getEffectiveTheme():"light";f.fillStyle=w==="dark"?"#fff":"#000",O.delete(-1)}}else{const u=window.themeManager?window.themeManager.getEffectiveTheme():"light";f.fillStyle=u==="dark"?"#fff":"#000"}f.fill();const r=l*.3,c=l+r*2;[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0},{x:1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:-1/Math.SQRT2},{x:1/Math.SQRT2,y:1/Math.SQRT2},{x:-1/Math.SQRT2,y:1/Math.SQRT2}].forEach((u,h)=>{var m;for(let w=1;w<=3;w++){const y=o+u.x*c*w,p=a+u.y*c*w,E=h*3+(w-1);f.beginPath(),f.arc(y,p,r,0,2*Math.PI);const b=(m=C[E])==null?void 0:m.clicked;if(O.has(E)){const{startTime:S,duration:D}=O.get(E),q=ke(S,D);if(q>0){const A=Math.floor(255*q),x=Math.floor(107*q),we=Math.floor(107*q);f.fillStyle=`rgb(${A}, ${x}, ${we})`,f.fill(),f.strokeStyle="#fff",f.lineWidth=2,f.stroke()}else{O.delete(E);const x=(window.themeManager?window.themeManager.getEffectiveTheme():"light")==="dark"?"#fff":"#000";b?(f.fillStyle=x,f.fill()):(f.strokeStyle=x,f.lineWidth=2,f.stroke())}}else{const D=(window.themeManager?window.themeManager.getEffectiveTheme():"light")==="dark"?"#fff":"#000";b?(f.fillStyle=D,f.fill()):(f.strokeStyle=D,f.lineWidth=2,f.stroke())}}}),f.restore()}function mt(i,e,t,n){const o=(window.themeManager?window.themeManager.getEffectiveTheme():"light")==="dark"?"255,255,255":"0,0,0";J.forEach((a,l)=>{f.beginPath(),f.arc(a.x,a.y,a.radius,0,Math.PI*2),f.strokeStyle=`rgba(${o},${a.alpha})`,f.lineWidth=2,f.stroke(),a.radius+=ct,a.alpha-=dt,a.alpha<=0&&J.splice(l,1)})}function ft(i,e=600){const t=Date.now();O.set(i,{startTime:t,duration:e})}function gt(){O.clear()}function wt(){J.push({x:125,y:125,radius:22.5,alpha:1})}function ge(){R.classList.contains("hidden")||(G(),requestAnimationFrame(ge))}window.modalHighlight={highlightModalCircle:ft,clearModalHighlights:gt,createModalRipple:wt,startAnimation:ge};k.addEventListener("click",async i=>{const e=k.getBoundingClientRect(),t=i.clientX-e.left,n=i.clientY-e.top,s=k.clientWidth,o=k.clientHeight,a=250,l=(s-a)/2,r=(o-a)/2,c=t-l,d=n-r,u=a/2,h=a/2,m=a*.09,w=m*.3,y=m+w*2;[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0},{x:1/Math.SQRT2,y:-1/Math.SQRT2},{x:-1/Math.SQRT2,y:-1/Math.SQRT2},{x:1/Math.SQRT2,y:1/Math.SQRT2},{x:-1/Math.SQRT2,y:1/Math.SQRT2}].forEach((E,b)=>{for(let S=1;S<=3;S++){const D=u+E.x*y*S,q=h+E.y*y*S,A=b*3+(S-1),x=C[A];if(x&&(c-D)**2+(d-q)**2<=w*w){x.clicked=!x.clicked,v.canvasRipple(k,t,n),M.trigger(x.clicked?"medium":"light"),x.clicked&&(x.audio.currentTime=0,x.audio.play()),ue(),G();return}}})});function ue(){const i=C.filter(e=>e.clicked).length;L.updateButtonStates(i)||(i>0?(F.disabled=!1,Q.disabled=!1):(F.disabled=!0,Q.disabled=!0))}F.addEventListener("click",async i=>{v.press(F,.95,100),M.trigger("medium"),await L.handleTestClick();const e=C.map((t,n)=>t.clicked?n:null).filter(t=>t!==null);if(e.length>0)try{window.audioSystem&&window.audioSystem.playSequence?await window.audioSystem.playSequence(e,{inModal:!0}):console.warn("Audio system not available, falling back to basic feedback"),L.isTutorialMode||(Q.disabled=!1)}catch(t){console.error("Error playing test sequence:",t),L.isTutorialMode||(Q.disabled=!1)}});$.addEventListener("change",()=>{const i=$.checked;H.disabled=!i,i?V.classList.remove("opacity-50"):V.classList.add("opacity-50")});Q.addEventListener("click",async()=>{v.press(Q,.95,100),M.trigger("success");const i=C.map((s,o)=>s.clicked?o:null).filter(s=>s!==null),e=$.checked,t=parseInt(H.value)||3,n={sequence:i,isLoop:e,loopInterval:t};try{if(window.modalManager.isEditMode){const s=await X(),o=Array.isArray(window.modalManager.originalSequenceData)?window.modalManager.originalSequenceData:window.modalManager.originalSequenceData.sequence||window.modalManager.originalSequenceData.seq,a=s.findIndex(l=>{const r=Array.isArray(l)?l:l.sequence||l.seq;return JSON.stringify(r)===JSON.stringify(o)});if(a!==-1){if(await ze(a,n),window.audioSystem&&window.audioSystem.isSequenceLooping&&window.audioSystem.isSequenceLooping(o,window.modalManager.editingThumbnail)){const l=window.modalManager.originalSequenceData.loopInterval||3;window.audioSystem.toggleLoopPlayback(o,l,window.modalManager.editingThumbnail)}window.modalManager.editingThumbnail.removeAttribute("data-editing"),window.modalManager.editingThumbnail.remove(),ee(n),console.log("âœ… Sequence updated successfully")}else throw new Error("Original sequence not found in storage")}else await Ne(n),ee(n),console.log("âœ… New sequence saved successfully");await L.handleSaveClick(),ne()}catch(s){console.error("âŒ Failed to save sequence:",s),alert("Failed to save sequence. Please try again.")}});function ne(){te(),R.classList.add("hidden"),R.classList.remove("flex"),R.setAttribute("aria-hidden","true"),window.modalManager.isEditMode&&window.modalManager.editingThumbnail&&window.modalManager.editingThumbnail.removeAttribute("data-editing"),window.modalManager.isEditMode=!1,window.modalManager.editingThumbnail=null,window.modalManager.originalSequenceData=null,C.forEach(i=>i.clicked=!1),F.disabled=!0,F.classList.remove("highlight-once"),Q.disabled=!0,L.cleanupTutorialState(),$.checked=!1,H.value=3,H.disabled=!0,V.style.opacity="0.5",window.modalHighlight&&window.modalHighlight.clearModalHighlights(),J.length=0,G()}const Le=document.getElementById("closeModalBtn");Le.addEventListener("click",()=>{v.press(Le,.9,100),M.trigger("light"),ne()});R.addEventListener("click",i=>{i.target===R&&ne()});const pt=document.getElementById("modalContent");pt.addEventListener("click",i=>{i.stopPropagation()});document.addEventListener("keydown",i=>{i.key==="Escape"&&!R.classList.contains("hidden")&&ne()});function ke(i,e){const t=Date.now()-i,n=Math.min(t/e,1),s=4,o=Math.max(0,1-n),a=Math.sin(t*s/100)*.3+.7;return o*a}window.modalManager=new Re;(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"||window.location.protocol==="file:")&&_e(()=>import("./dev-tools-B8MGEmSN.js"),[]).catch(i=>{console.log("Dev tools not loaded (production build)")});console.log("ðŸŽµ Swarm Rippler app initialized");export{N as o};
